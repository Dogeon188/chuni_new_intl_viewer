(function(){"use strict";function De(e){const t=document.cookie.split(";").map(n=>decodeURIComponent(n.trim())).map(n=>n.split("=")).find(n=>n[0]===e);return t?t[1]:""}function Ie(){return/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)}function ft(e){return Number([...e].filter(t=>t!==",").join(""))}function q(){}function Me(e){return e()}function Be(){return Object.create(null)}function ee(e){e.forEach(Me)}function ht(e){return typeof e=="function"}function le(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function dt(e){return Object.keys(e).length===0}function mt(e,...t){if(e==null)return q;const n=e.subscribe(...t);return n.unsubscribe?()=>n.unsubscribe():n}function gt(e,t,n){e.$$.on_destroy.push(mt(t,n))}function h(e,t){e.appendChild(t)}function ge(e,t,n){const r=pt(e);if(!r.getElementById(t)){const i=g("style");i.id=t,i.textContent=n,vt(r,i)}}function pt(e){if(!e)return document;const t=e.getRootNode?e.getRootNode():e.ownerDocument;return t&&t.host?t:e.ownerDocument}function vt(e,t){h(e.head||e,t)}function W(e,t,n){e.insertBefore(t,n||null)}function U(e){e.parentNode.removeChild(e)}function Ue(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function g(e){return document.createElement(e)}function j(e){return document.createTextNode(e)}function S(){return j(" ")}function ce(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function v(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function wt(e){return Array.from(e.childNodes)}function L(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}function te(e,t,n){e.classList[n?"add":"remove"](t)}let Ee;function ae(e){Ee=e}const ue=[],Ve=[],pe=[],He=[],bt=Promise.resolve();let Te=!1;function _t(){Te||(Te=!0,bt.then(qe))}function $e(e){pe.push(e)}const Re=new Set;let ve=0;function qe(){const e=Ee;do{for(;ve<ue.length;){const t=ue[ve];ve++,ae(t),yt(t.$$)}for(ae(null),ue.length=0,ve=0;Ve.length;)Ve.pop()();for(let t=0;t<pe.length;t+=1){const n=pe[t];Re.has(n)||(Re.add(n),n())}pe.length=0}while(ue.length);for(;He.length;)He.pop()();Te=!1,Re.clear(),ae(e)}function yt(e){if(e.fragment!==null){e.update(),ee(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach($e)}}const we=new Set;let Y;function St(){Y={r:0,c:[],p:Y}}function jt(){Y.r||ee(Y.c),Y=Y.p}function J(e,t){e&&e.i&&(we.delete(e),e.i(t))}function Z(e,t,n,r){if(e&&e.o){if(we.has(e))return;we.add(e),Y.c.push(()=>{we.delete(e),r&&(n&&e.d(1),r())}),e.o(t)}}function fe(e){e&&e.c()}function ne(e,t,n,r){const{fragment:i,on_mount:o,on_destroy:s,after_update:l}=e.$$;i&&i.m(t,n),r||$e(()=>{const a=o.map(Me).filter(ht);s?s.push(...a):ee(a),e.$$.on_mount=[]}),l.forEach($e)}function re(e,t){const n=e.$$;n.fragment!==null&&(ee(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function xt(e,t){e.$$.dirty[0]===-1&&(ue.push(e),_t(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function be(e,t,n,r,i,o,s,l=[-1]){const a=Ee;ae(e);const c=e.$$={fragment:null,ctx:null,props:o,update:q,not_equal:i,bound:Be(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(a?a.$$.context:[])),callbacks:Be(),dirty:l,skip_bound:!1,root:t.target||a.$$.root};s&&s(c.root);let u=!1;if(c.ctx=n?n(e,t.props||{},(f,_,...A)=>{const y=A.length?A[0]:_;return c.ctx&&i(c.ctx[f],c.ctx[f]=y)&&(!c.skip_bound&&c.bound[f]&&c.bound[f](y),u&&xt(e,f)),_}):[],c.update(),u=!0,ee(c.before_update),c.fragment=r?r(c.ctx):!1,t.target){if(t.hydrate){const f=wt(t.target);c.fragment&&c.fragment.l(f),f.forEach(U)}else c.fragment&&c.fragment.c();t.intro&&J(e.$$.fragment),ne(e,t.target,t.anchor,t.customElement),qe()}ae(a)}class _e{$destroy(){re(this,1),this.$destroy=q}$on(t,n){const r=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return r.push(n),()=>{const i=r.indexOf(n);i!==-1&&r.splice(i,1)}}$set(t){this.$$set&&!dt(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}function kt(e,t){t*=100;const n=[[101e4,t+215],[1009e3,t+215],[1007500,t+200],[1005e3,t+150],[1e6,t+100],[975e3,t],[925e3,t-300],[9e5,t-500],[8e5,(t-500)/2],[5e5,0]];let r=1;n.some((l,a)=>(r=a,e>l[0]));const i=n[r-1],o=n[r],s=o[1]+(i[1]-o[1])/(i[0]-o[0])*(e-o[0]);return Math.floor(s+Number.EPSILON)/100}function We(e){return e.slice(0,30).reduce((t,n)=>t+n)/30}function Et(e){return(We(e)*30+e[0]*10)/40}const ie=[];function Tt(e,t=q){let n;const r=new Set;function i(l){if(le(e,l)&&(e=l,n)){const a=!ie.length;for(const c of r)c[1](),ie.push(c,e);if(a){for(let c=0;c<ie.length;c+=2)ie[c][0](ie[c+1]);ie.length=0}}}function o(l){i(l(e))}function s(l,a=q){const c=[l,a];return r.add(c),r.size===1&&(n=t(i)||q),l(e),()=>{r.delete(c),r.size===0&&(n(),n=null)}}return{set:i,update:o,subscribe:s}}const ye=Tt(""),X={ultima:"ULT",master:"MAS",expert:"EXP",advanced:"ADV",basic:"BAS"};async function $t(e=X.master){const t=new FormData;t.append("genre","99"),t.append("token",De("_t"));const n={[X.ultima]:"sendUltima",[X.master]:"sendMaster",[X.expert]:"sendExpert",[X.advanced]:"sendAdvanced",[X.basic]:"sendBasic"},r=await fetch(`https://chunithm-net-eng.com/mobile/record/musicGenre/${n[e]}`,{headers:{"Cache-Control":"no-cache"},method:"POST",body:t}),i=[...$(await r.text()).find("form")];return i.shift(),i}async function Rt(){const e=[];for(const t of Object.values(X))ye.set(`Fetching ${t} record...`),e.push(await $t(t));return e.flatMap((t,n)=>t.map(r=>{var l,a;const i=$(r),o=i.find(".play_musicdata_icon");let s=null;return o.length&&(o.find('img[src*="alljustice"]').length?s="AJ":o.find('img[src*="fullcombo"]').length&&(s="FC")),{title:(l=i.find(".music_title"))==null?void 0:l.text(),score:ft((a=i.find(".text_b"))==null?void 0:a.text()),difficulty:Object.values(X)[n],clear:s}}).filter(r=>r.title!==null&&r.score>0))}async function Pt(){ye.set("Fetching song data...");const e=await(await fetch("https://raw.githubusercontent.com/Dogeon188/chuni_new_intl_viewer/main/songData.json")).json(),t=await Rt();return ye.set("Calculating data..."),t.map(n=>{const r=e[n.title];if(r===void 0){alert(`[chuni-intl-viewer] Found unknown song "${n.title} ${n.difficulty}".
The data should be updating soon, please run chuni-viewer again later to get proper song data.`),fetch(new Request("https://chuniupdate.dogeon188.repl.co/sendUpdate",{method:"POST"})),n.const=0,n.rating=0;return}n.const=r[n.difficulty],n.rating=kt(n.score,n.const)}),t.sort((n,r)=>r.rating-n.rating||r.const-n.const),t.map((n,r)=>{n.rank=r+1}),t}async function Ct(){const e=await fetch("https://chunithm-net-eng.com/mobile/home/"),t=$(await e.text());let n=[...t.find(".player_rating_num_block img")].map(r=>{var s,l;const i=(s=r.getAttribute("src"))!=null?s:"";return/rating_.*_comma.png/.test(i)?".":((l=/rating_.*_[0-9]*(?=.png)/g.exec(i))!=null?l:[])[0].slice(-1)}).join("");return{name:t.find(".player_name_in")[0].innerHTML,honor:t.find(".player_honor_text_view span")[0].innerHTML,rating:n}}function Lt(e){ge(e,"svelte-1eqa0h1","div.svelte-1eqa0h1{padding:5px}.overview-title.svelte-1eqa0h1{color:#c9e;font-size:small}.overview-content.svelte-1eqa0h1{margin-inline-start:0}")}function At(e){let t,n,r,i,o,s,l;return{c(){t=g("div"),n=g("span"),r=j(e[0]),i=S(),o=g("span"),s=j(e[1]),l=g("span"),v(n,"class","overview-title svelte-1eqa0h1"),v(o,"class","overview-content svelte-1eqa0h1"),v(t,"class","svelte-1eqa0h1")},m(a,c){W(a,t,c),h(t,n),h(n,r),h(t,i),h(t,o),h(o,s),h(o,l)},p(a,[c]){c&1&&L(r,a[0]),c&2&&L(s,a[1])},i:q,o:q,d(a){a&&U(t)}}}function Ot(e,t,n){let{title:r}=t,{content:i}=t;return e.$$set=o=>{"title"in o&&n(0,r=o.title),"content"in o&&n(1,i=o.content)},[r,i]}class Pe extends _e{constructor(t){super(),be(this,t,Ot,At,le,{title:0,content:1},Lt)}}function Ft(e){ge(e,"svelte-18s7wo8","div#chuni-overview.svelte-18s7wo8.svelte-18s7wo8{border:#436 3px solid;border-radius:0.5rem;background-color:#224;width:fit-content;padding:0.5rem;margin:0.5rem;text-align:left;display:grid;align-items:center;width:calc(100% - 2rem - 6px)}div#chuni-overview.svelte-18s7wo8 .stats-name.svelte-18s7wo8{grid-column:1;text-align:center;font-weight:bold}div#chuni-overview.svelte-18s7wo8 .stats-rating.svelte-18s7wo8{grid-column:2}div#chuni-overview.svelte-18s7wo8 .stats-honor.svelte-18s7wo8{grid-area:2/1/2/3;text-align:center;color:#aab;background:#113;border-radius:3px;padding:5px;margin:0 20px}div#chuni-overview.svelte-18s7wo8 .overview-items.svelte-18s7wo8{display:flex;flex-direction:column;grid-area:1/3/3/3}")}function Dt(e){let t,n,r=e[2].name+"",i,o,s,l=e[2].rating+"",a,c,u,f=e[2].honor+"",_,A,y,P,d,p,O,T,C;return P=new Pe({props:{title:"Generated at",content:new Date().toLocaleDateString()}}),p=new Pe({props:{title:"B30 Avg.",content:e[0].toFixed(2)}}),T=new Pe({props:{title:"Max Rating",content:e[1].toFixed(2)}}),{c(){t=g("div"),n=g("h2"),i=j(r),o=S(),s=g("h3"),a=j(l),c=S(),u=g("div"),_=j(f),A=S(),y=g("div"),fe(P.$$.fragment),d=S(),fe(p.$$.fragment),O=S(),fe(T.$$.fragment),v(n,"class","stats-name svelte-18s7wo8"),v(s,"class","stats-rating svelte-18s7wo8"),v(u,"class","stats-honor svelte-18s7wo8"),v(y,"class","overview-items svelte-18s7wo8"),v(t,"id","chuni-overview"),v(t,"class","svelte-18s7wo8")},m(w,k){W(w,t,k),h(t,n),h(n,i),h(t,o),h(t,s),h(s,a),h(t,c),h(t,u),h(u,_),h(t,A),h(t,y),ne(P,y,null),h(y,d),ne(p,y,null),h(y,O),ne(T,y,null),C=!0},p(w,[k]){(!C||k&4)&&r!==(r=w[2].name+"")&&L(i,r),(!C||k&4)&&l!==(l=w[2].rating+"")&&L(a,l),(!C||k&4)&&f!==(f=w[2].honor+"")&&L(_,f);const V={};k&1&&(V.content=w[0].toFixed(2)),p.$set(V);const B={};k&2&&(B.content=w[1].toFixed(2)),T.$set(B)},i(w){C||(J(P.$$.fragment,w),J(p.$$.fragment,w),J(T.$$.fragment,w),C=!0)},o(w){Z(P.$$.fragment,w),Z(p.$$.fragment,w),Z(T.$$.fragment,w),C=!1},d(w){w&&U(t),re(P),re(p),re(T)}}}function It(e,t,n){let{b30:r}=t,{maxAchievable:i}=t,{playerStats:o}=t;return e.$$set=s=>{"b30"in s&&n(0,r=s.b30),"maxAchievable"in s&&n(1,i=s.maxAchievable),"playerStats"in s&&n(2,o=s.playerStats)},[r,i,o]}class Mt extends _e{constructor(t){super(),be(this,t,It,Dt,le,{b30:0,maxAchievable:1,playerStats:2},Ft)}}var ze=globalThis&&globalThis.__awaiter||function(e,t,n,r){function i(o){return o instanceof n?o:new n(function(s){s(o)})}return new(n||(n=Promise))(function(o,s){function l(u){try{c(r.next(u))}catch(f){s(f)}}function a(u){try{c(r.throw(u))}catch(f){s(f)}}function c(u){u.done?o(u.value):i(u.value).then(l,a)}c((r=r.apply(e,t||[])).next())})};const Ge="application/font-woff",Je="image/jpeg",Bt={woff:Ge,woff2:Ge,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:Je,jpeg:Je,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml"};function Ut(e){const t=/\.([^./]*?)$/g.exec(e);return t?t[1]:""}function Se(e){const t=Ut(e).toLowerCase();return Bt[t]||""}function Vt(e,t){if(e.match(/^[a-z]+:\/\//i))return e;if(e.match(/^\/\//))return window.location.protocol+e;if(e.match(/^[a-z]+:/i))return e;const n=document.implementation.createHTMLDocument(),r=n.createElement("base"),i=n.createElement("a");return n.head.appendChild(r),n.body.appendChild(i),t&&(r.href=t),i.href=e,i.href}function Ce(e){return e.search(/^(data:)/)!==-1}function je(e,t){return`data:${t};base64,${e}`}function Ht(e){return e.split(/,/)[1]}const qt=function(){let t=0;const n=()=>`0000${(Math.random()*Math.pow(36,4)<<0).toString(36)}`.slice(-4);return()=>(t+=1,`u${n()}${t}`)}();function K(e){const t=[];for(let n=0,r=e.length;n<r;n+=1)t.push(e[n]);return t}function xe(e,t){const n=window.getComputedStyle(e).getPropertyValue(t);return parseFloat(n.replace("px",""))}function Wt(e){const t=xe(e,"border-left-width"),n=xe(e,"border-right-width");return e.clientWidth+t+n}function zt(e){const t=xe(e,"border-top-width"),n=xe(e,"border-bottom-width");return e.clientHeight+t+n}function Gt(){let e,t;try{t=process}catch{}const n=t&&t.env?t.env.devicePixelRatio:null;return n&&(e=parseInt(n,10),Number.isNaN(e)&&(e=1)),e||window.devicePixelRatio||1}function Jt(e){return e.toBlob?new Promise(t=>e.toBlob(t)):new Promise(t=>{const n=window.atob(e.toDataURL().split(",")[1]),r=n.length,i=new Uint8Array(r);for(let o=0;o<r;o+=1)i[o]=n.charCodeAt(o);t(new Blob([i],{type:"image/png"}))})}function Le(e){return new Promise((t,n)=>{const r=new Image;r.onload=()=>t(r),r.onerror=n,r.crossOrigin="anonymous",r.decoding="sync",r.src=e})}function Xt(e){return ze(this,void 0,void 0,function*(){return Promise.resolve().then(()=>new XMLSerializer().serializeToString(e)).then(encodeURIComponent).then(t=>`data:image/svg+xml;charset=utf-8,${t}`)})}function Kt(e,t,n){return ze(this,void 0,void 0,function*(){const r="http://www.w3.org/2000/svg",i=document.createElementNS(r,"svg"),o=document.createElementNS(r,"foreignObject");return i.setAttribute("width",`${t}`),i.setAttribute("height",`${n}`),i.setAttribute("viewBox",`0 0 ${t} ${n}`),o.setAttribute("width","100%"),o.setAttribute("height","100%"),o.setAttribute("x","0"),o.setAttribute("y","0"),o.setAttribute("externalResourcesRequired","true"),i.appendChild(o),o.appendChild(e),Xt(i)})}const Ae={};function Qt(e){let t=e.replace(/\?.*/,"");return/ttf|otf|eot|woff2?/i.test(t)&&(t=t.replace(/.*\//,"")),t}function Oe(e,t){const n=Qt(e);if(Ae[n]!=null)return Ae[n];t.cacheBust&&(e+=(/\?/.test(e)?"&":"?")+new Date().getTime());const r=o=>{let s="";if(t.imagePlaceholder){const a=t.imagePlaceholder.split(/,/);a&&a[1]&&(s=a[1])}let l=`Failed to fetch resource: ${e}`;return o&&(l=typeof o=="string"?o:o.message),l&&console.error(l),{blob:s,contentType:""}},i=window.fetch(e).then(o=>o.blob().then(s=>({blob:s,contentType:o.headers.get("Content-Type")||""}))).then(({blob:o,contentType:s})=>new Promise((l,a)=>{const c=new FileReader;c.onloadend=()=>l({contentType:s,blob:c.result}),c.onerror=a,c.readAsDataURL(o)})).then(({blob:o,contentType:s})=>({contentType:s,blob:Ht(o)})).catch(r);return Ae[n]=i,i}function Yt(e){const t=e.getPropertyValue("content");return`${e.cssText} content: '${t.replace(/'|"/g,"")}';`}function Zt(e){return K(e).map(t=>{const n=e.getPropertyValue(t),r=e.getPropertyPriority(t);return`${t}: ${n}${r?" !important":""};`}).join(" ")}function Nt(e,t,n){const r=`.${e}:${t}`,i=n.cssText?Yt(n):Zt(n);return document.createTextNode(`${r}{${i}}`)}function Xe(e,t,n){const r=window.getComputedStyle(e,n),i=r.getPropertyValue("content");if(i===""||i==="none")return;const o=qt();try{t.className=`${t.className} ${o}`}catch{return}const s=document.createElement("style");s.appendChild(Nt(o,n,r)),t.appendChild(s)}function en(e,t){Xe(e,t,":before"),Xe(e,t,":after")}var oe=globalThis&&globalThis.__awaiter||function(e,t,n,r){function i(o){return o instanceof n?o:new n(function(s){s(o)})}return new(n||(n=Promise))(function(o,s){function l(u){try{c(r.next(u))}catch(f){s(f)}}function a(u){try{c(r.throw(u))}catch(f){s(f)}}function c(u){u.done?o(u.value):i(u.value).then(l,a)}c((r=r.apply(e,t||[])).next())})};function tn(e){return oe(this,void 0,void 0,function*(){const t=e.toDataURL();return t==="data:,"?Promise.resolve(e.cloneNode(!1)):Le(t)})}function nn(e,t){return oe(this,void 0,void 0,function*(){return Promise.resolve(e.poster).then(n=>Oe(n,t)).then(n=>je(n.blob,Se(e.poster)||n.contentType)).then(n=>Le(n))})}function rn(e,t){return oe(this,void 0,void 0,function*(){return e instanceof HTMLCanvasElement?tn(e):e instanceof HTMLVideoElement&&e.poster?nn(e,t):Promise.resolve(e.cloneNode(!1))})}const on=e=>e.tagName!=null&&e.tagName.toUpperCase()==="SLOT";function sn(e,t,n){var r;return oe(this,void 0,void 0,function*(){const i=on(e)&&e.assignedNodes?K(e.assignedNodes()):K(((r=e.shadowRoot)!==null&&r!==void 0?r:e).childNodes);return i.length===0||e instanceof HTMLVideoElement?Promise.resolve(t):i.reduce((o,s)=>o.then(()=>Ke(s,n)).then(l=>{l&&t.appendChild(l)}),Promise.resolve()).then(()=>t)})}function ln(e,t){const n=window.getComputedStyle(e),r=t.style;!r||(n.cssText?r.cssText=n.cssText:K(n).forEach(i=>{r.setProperty(i,n.getPropertyValue(i),n.getPropertyPriority(i))}))}function cn(e,t){e instanceof HTMLTextAreaElement&&(t.innerHTML=e.value),e instanceof HTMLInputElement&&t.setAttribute("value",e.value)}function an(e,t){return oe(this,void 0,void 0,function*(){return t instanceof Element?Promise.resolve().then(()=>ln(e,t)).then(()=>en(e,t)).then(()=>cn(e,t)).then(()=>t):Promise.resolve(t)})}function Ke(e,t,n){return oe(this,void 0,void 0,function*(){return!n&&t.filter&&!t.filter(e)?Promise.resolve(null):Promise.resolve(e).then(r=>rn(r,t)).then(r=>sn(e,r,t)).then(r=>an(e,r))})}var un=globalThis&&globalThis.__awaiter||function(e,t,n,r){function i(o){return o instanceof n?o:new n(function(s){s(o)})}return new(n||(n=Promise))(function(o,s){function l(u){try{c(r.next(u))}catch(f){s(f)}}function a(u){try{c(r.throw(u))}catch(f){s(f)}}function c(u){u.done?o(u.value):i(u.value).then(l,a)}c((r=r.apply(e,t||[])).next())})};const Qe=/url\((['"]?)([^'"]+?)\1\)/g,fn=/url\([^)]+\)\s*format\((["'])([^"']+)\1\)/g,hn=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function dn(e){const t=e.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1");return new RegExp(`(url\\(['"]?)(${t})(['"]?\\))`,"g")}function mn(e){const t=[];return e.replace(Qe,(n,r,i)=>(t.push(i),n)),t.filter(n=>!Ce(n))}function gn(e,t,n,r,i){const o=n?Vt(t,n):t;return Promise.resolve(o).then(s=>i?i(s):Oe(s,r)).then(s=>typeof s=="string"?je(s,Se(t)):je(s.blob,Se(t)||s.contentType)).then(s=>e.replace(dn(t),`$1${s}$3`)).then(s=>s,()=>o)}function pn(e,{preferredFontFormat:t}){return t?e.replace(hn,n=>{for(;;){const[r,,i]=fn.exec(n)||[];if(!i)return"";if(i===t)return`src: ${r};`}}):e}function Ye(e){return e.search(Qe)!==-1}function Ze(e,t,n){return un(this,void 0,void 0,function*(){if(!Ye(e))return Promise.resolve(e);const r=pn(e,n);return Promise.resolve(r).then(mn).then(i=>i.reduce((o,s)=>o.then(l=>gn(l,s,t,n)),Promise.resolve(r)))})}var ke=globalThis&&globalThis.__awaiter||function(e,t,n,r){function i(o){return o instanceof n?o:new n(function(s){s(o)})}return new(n||(n=Promise))(function(o,s){function l(u){try{c(r.next(u))}catch(f){s(f)}}function a(u){try{c(r.throw(u))}catch(f){s(f)}}function c(u){u.done?o(u.value):i(u.value).then(l,a)}c((r=r.apply(e,t||[])).next())})};function vn(e,t){var n;return ke(this,void 0,void 0,function*(){const r=(n=e.style)===null||n===void 0?void 0:n.getPropertyValue("background");return r?Promise.resolve(r).then(i=>Ze(i,null,t)).then(i=>(e.style.setProperty("background",i,e.style.getPropertyPriority("background")),e)):Promise.resolve(e)})}function wn(e,t){return ke(this,void 0,void 0,function*(){if(!(e instanceof HTMLImageElement&&!Ce(e.src))&&!(e instanceof SVGImageElement&&!Ce(e.href.baseVal)))return Promise.resolve(e);const n=e instanceof HTMLImageElement?e.src:e.href.baseVal;return Promise.resolve(n).then(r=>Oe(r,t)).then(r=>je(r.blob,Se(n)||r.contentType)).then(r=>new Promise((i,o)=>{e.onload=i,e.onerror=o,e instanceof HTMLImageElement?(e.srcset="",e.src=r):e.href.baseVal=r})).then(()=>e,()=>e)})}function bn(e,t){return ke(this,void 0,void 0,function*(){const r=K(e.childNodes).map(i=>Ne(i,t));return Promise.all(r).then(()=>e)})}function Ne(e,t){return ke(this,void 0,void 0,function*(){return e instanceof Element?Promise.resolve(e).then(n=>vn(n,t)).then(n=>wn(n,t)).then(n=>bn(n,t)):Promise.resolve(e)})}function _n(e,t){const{style:n}=e;t.backgroundColor&&(n.backgroundColor=t.backgroundColor),t.width&&(n.width=`${t.width}px`),t.height&&(n.height=`${t.height}px`);const r=t.style;return r!=null&&Object.keys(r).forEach(i=>{n[i]=r[i]}),e}var he=globalThis&&globalThis.__awaiter||function(e,t,n,r){function i(o){return o instanceof n?o:new n(function(s){s(o)})}return new(n||(n=Promise))(function(o,s){function l(u){try{c(r.next(u))}catch(f){s(f)}}function a(u){try{c(r.throw(u))}catch(f){s(f)}}function c(u){u.done?o(u.value):i(u.value).then(l,a)}c((r=r.apply(e,t||[])).next())})};const et={};function tt(e){const t=et[e];if(t!=null)return t;const n=window.fetch(e).then(r=>({url:e,cssText:r.text()}));return et[e]=n,n}function nt(e){return he(this,void 0,void 0,function*(){return e.cssText.then(t=>{let n=t;const r=/url\(["']?([^"')]+)["']?\)/g,o=(n.match(/url\([^)]+\)/g)||[]).map(s=>{let l=s.replace(r,"$1");return l.startsWith("https://")||(l=new URL(l,e.url).href),window.fetch(l).then(a=>a.blob()).then(a=>new Promise((c,u)=>{const f=new FileReader;f.onloadend=()=>{n=n.replace(s,`url(${f.result})`),c([s,f.result])},f.onerror=u,f.readAsDataURL(a)}))});return Promise.all(o).then(()=>n)})})}function rt(e){if(e==null)return[];const t=[],n=/(\/\*[\s\S]*?\*\/)/gi;let r=e.replace(n,"");const i=new RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");for(;;){const a=i.exec(r);if(a===null)break;t.push(a[0])}r=r.replace(i,"");const o=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,s="((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})",l=new RegExp(s,"gi");for(;;){let a=o.exec(r);if(a===null){if(a=l.exec(r),a===null)break;o.lastIndex=l.lastIndex}else l.lastIndex=o.lastIndex;t.push(a[0])}return t}function yn(e){return he(this,void 0,void 0,function*(){const t=[],n=[];return e.forEach(r=>{if("cssRules"in r)try{K(r.cssRules).forEach((i,o)=>{if(i.type===CSSRule.IMPORT_RULE){let s=o+1;const l=i.href,a=tt(l).then(c=>c?nt(c):"").then(c=>rt(c).forEach(u=>{try{r.insertRule(u,u.startsWith("@import")?s+=1:r.cssRules.length)}catch(f){console.error("Error inserting rule from remote css",{rule:u,error:f})}})).catch(c=>{console.error("Error loading remote css",c.toString())});n.push(a)}})}catch(i){const o=e.find(s=>s.href==null)||document.styleSheets[0];r.href!=null&&n.push(tt(r.href).then(s=>s?nt(s):"").then(s=>rt(s).forEach(l=>{o.insertRule(l,r.cssRules.length)})).catch(s=>{console.error("Error loading remote stylesheet",s.toString())})),console.error("Error inlining remote css file",i.toString())}}),Promise.all(n).then(()=>(e.forEach(r=>{if("cssRules"in r)try{K(r.cssRules).forEach(i=>{t.push(i)})}catch(i){console.error(`Error while reading CSS rules from ${r.href}`,i.toString())}}),t))})}function Sn(e){return e.filter(t=>t.type===CSSRule.FONT_FACE_RULE).filter(t=>Ye(t.style.getPropertyValue("src")))}function jn(e){return he(this,void 0,void 0,function*(){return new Promise((t,n)=>{e.ownerDocument==null&&n(new Error("Provided element is not within a Document")),t(K(e.ownerDocument.styleSheets))}).then(t=>yn(t)).then(Sn)})}function xn(e,t){return he(this,void 0,void 0,function*(){return jn(e).then(n=>Promise.all(n.map(r=>{const i=r.parentStyleSheet?r.parentStyleSheet.href:null;return Ze(r.cssText,i,t)}))).then(n=>n.join(`
`))})}function kn(e,t){return he(this,void 0,void 0,function*(){return(t.fontEmbedCSS!=null?Promise.resolve(t.fontEmbedCSS):xn(e,t)).then(n=>{const r=document.createElement("style"),i=document.createTextNode(n);return r.appendChild(i),e.firstChild?e.insertBefore(r,e.firstChild):e.appendChild(r),e})})}var Fe=globalThis&&globalThis.__awaiter||function(e,t,n,r){function i(o){return o instanceof n?o:new n(function(s){s(o)})}return new(n||(n=Promise))(function(o,s){function l(u){try{c(r.next(u))}catch(f){s(f)}}function a(u){try{c(r.throw(u))}catch(f){s(f)}}function c(u){u.done?o(u.value):i(u.value).then(l,a)}c((r=r.apply(e,t||[])).next())})};function it(e,t={}){const n=t.width||Wt(e),r=t.height||zt(e);return{width:n,height:r}}function En(e,t={}){return Fe(this,void 0,void 0,function*(){const{width:n,height:r}=it(e,t);return Promise.resolve(e).then(i=>Ke(i,t,!0)).then(i=>kn(i,t)).then(i=>Ne(i,t)).then(i=>_n(i,t)).then(i=>Kt(i,n,r))})}const D=16384;function Tn(e){(e.width>D||e.height>D)&&(e.width>D&&e.height>D?e.width>e.height?(e.height*=D/e.width,e.width=D):(e.width*=D/e.height,e.height=D):e.width>D?(e.height*=D/e.width,e.width=D):(e.width*=D/e.height,e.height=D))}function $n(e,t={}){return Fe(this,void 0,void 0,function*(){return En(e,t).then(Le).then(n=>{const r=document.createElement("canvas"),i=r.getContext("2d"),o=t.pixelRatio||Gt(),{width:s,height:l}=it(e,t),a=t.canvasWidth||s,c=t.canvasHeight||l;return r.width=a*o,r.height=c*o,t.skipAutoScale||Tn(r),r.style.width=`${a}`,r.style.height=`${c}`,t.backgroundColor&&(i.fillStyle=t.backgroundColor,i.fillRect(0,0,r.width,r.height)),i.drawImage(n,0,0,r.width,r.height),r})})}function Rn(e,t={}){return Fe(this,void 0,void 0,function*(){return $n(e,t).then(Jt)})}async function ot(e){var r,i;const t=(r=document.body.shadowRoot)==null?void 0:r.querySelector("main");let n=t==null?void 0:t.cloneNode(!0);(i=t==null?void 0:t.parentElement)==null||i.appendChild(n),n.style.margin="initial",n.querySelectorAll("tr").forEach((o,s)=>{s>(e=="b30"?30:40)&&o.remove()}),Rn(n,{backgroundColor:"#113"}).then(async o=>{if(n.remove(),o==null)return alert("[chuni-intl-viewer] Something went wrong when converting your scores to PNG. Please ask the author to fix it.");if(Ie()){const s=new File([o],`result_${e}.png`,{type:o.type});navigator!=null&&navigator.canShare({files:[s]})&&navigator.share({files:[s]}).catch(console.log)}else $("<a>").attr({download:`result_${e}.png`,href:window.URL.createObjectURL(o)})[0].click()})}function Pn(e){ge(e,"svelte-h7j0em","main.svelte-h7j0em.svelte-h7j0em{width:fit-content;margin:auto}button.svelte-h7j0em.svelte-h7j0em{margin:0.5rem;padding:0.3rem;font-family:inherit;font-weight:bold;background-color:#324;border:#536 3px solid;color:#eec;border-radius:0.3rem;cursor:pointer}button.svelte-h7j0em.svelte-h7j0em:disabled{cursor:default;opacity:0.5}button.filter.svelte-h7j0em.svelte-h7j0em,button.sort.svelte-h7j0em.svelte-h7j0em{border-color:#48c;background-color:#159}button.sort.svelte-h7j0em.svelte-h7j0em{width:7rem}button.dl.svelte-h7j0em i.svelte-h7j0em{background-image:url(https://raw.githubusercontent.com/Dogeon188/chuni_new_intl_viewer/main/assets/dl.png);display:inline-block;width:1rem;height:1rem;background-position:0px 0px;background-size:cover}table.svelte-h7j0em.svelte-h7j0em{border-spacing:0;width:100%;padding-bottom:0.5rem;max-width:max-content;margin:auto}td.svelte-h7j0em.svelte-h7j0em,th.svelte-h7j0em.svelte-h7j0em{padding:0.5rem}th.current-sort.svelte-h7j0em.svelte-h7j0em{text-decoration:underline double #669}tbody.svelte-h7j0em tr.best30 td.svelte-h7j0em:first-child{color:#fc4}tbody.svelte-h7j0em tr.best40 td.svelte-h7j0em:first-child{font-weight:bold}tbody.svelte-h7j0em tr.svelte-h7j0em:nth-child(odd){background-color:#224}tbody.svelte-h7j0em tr td.svelte-h7j0em:nth-child(2){overflow:hidden;text-overflow:ellipsis;font-weight:bold;text-align:initial;max-width:300px}tbody.svelte-h7j0em tr td:nth-child(2).diff-ult.svelte-h7j0em{color:#3cf}tbody.svelte-h7j0em tr td:nth-child(2).diff-mas.svelte-h7j0em{color:#e9f}tbody.svelte-h7j0em tr td:nth-child(2).diff-exp.svelte-h7j0em{color:#e46}tbody.svelte-h7j0em tr td:nth-child(2).diff-adv.svelte-h7j0em{color:#e73}tbody.svelte-h7j0em tr td:nth-child(2).diff-bas.svelte-h7j0em{color:#1c3}span.clear-fc.svelte-h7j0em.svelte-h7j0em{color:#5e7;font-weight:bold}span.clear-aj.svelte-h7j0em.svelte-h7j0em{color:#fc1;font-weight:bold}")}function st(e,t,n){const r=e.slice();return r[13]=t[n],r}function lt(e,t,n){const r=e.slice();return r[16]=t[n],r}function ct(e){let t,n,r,i;function o(){return e[12](e[16])}return{c(){t=g("th"),n=j(e[16]),v(t,"class","svelte-h7j0em"),te(t,"current-sort",e[16]==Object.keys(e[4])[e[2]])},m(s,l){W(s,t,l),h(t,n),r||(i=ce(t,"click",o),r=!0)},p(s,l){e=s,l&20&&te(t,"current-sort",e[16]==Object.keys(e[4])[e[2]])},d(s){s&&U(t),r=!1,i()}}}function at(e){let t,n=e[13].clear+"",r,i;return{c(){var o;t=g("span"),r=j(n),v(t,"class",i="clear-"+((o=e[13].clear)==null?void 0:o.toLowerCase())+" svelte-h7j0em")},m(o,s){W(o,t,s),h(t,r)},p(o,s){var l;s&8&&n!==(n=o[13].clear+"")&&L(r,n),s&8&&i!==(i="clear-"+((l=o[13].clear)==null?void 0:l.toLowerCase())+" svelte-h7j0em")&&v(t,"class",i)},d(o){o&&U(t)}}}function ut(e){var N,de,Q,H;let t,n,r=e[13].rank+"",i,o,s,l=e[13].title+"",a,c,u,f,_=((de=(N=e[13].const)==null?void 0:N.toFixed(1))!=null?de:"??.?")+"",A,y,P,d=e[13].score+"",p,O,T,C=((H=(Q=e[13].rating)==null?void 0:Q.toFixed(2))!=null?H:"??.??")+"",w,k,V,B,E=e[13].clear!==null&&at(e);return{c(){t=g("tr"),n=g("td"),i=j(r),o=S(),s=g("td"),a=j(l),u=S(),f=g("td"),A=j(_),y=S(),P=g("td"),p=j(d),O=S(),T=g("td"),w=j(C),k=S(),V=g("td"),E&&E.c(),B=S(),v(n,"class","svelte-h7j0em"),v(s,"class",c="diff-"+e[13].difficulty.toLowerCase()+" svelte-h7j0em"),v(f,"class","svelte-h7j0em"),v(P,"class","svelte-h7j0em"),v(T,"class","svelte-h7j0em"),v(V,"class","svelte-h7j0em"),v(t,"class","svelte-h7j0em"),te(t,"best30",e[13].rank<=30),te(t,"best40",e[13].rank<=40)},m(x,F){W(x,t,F),h(t,n),h(n,i),h(t,o),h(t,s),h(s,a),h(t,u),h(t,f),h(f,A),h(t,y),h(t,P),h(P,p),h(t,O),h(t,T),h(T,w),h(t,k),h(t,V),E&&E.m(V,null),h(t,B)},p(x,F){var se,I,G,R;F&8&&r!==(r=x[13].rank+"")&&L(i,r),F&8&&l!==(l=x[13].title+"")&&L(a,l),F&8&&c!==(c="diff-"+x[13].difficulty.toLowerCase()+" svelte-h7j0em")&&v(s,"class",c),F&8&&_!==(_=((I=(se=x[13].const)==null?void 0:se.toFixed(1))!=null?I:"??.?")+"")&&L(A,_),F&8&&d!==(d=x[13].score+"")&&L(p,d),F&8&&C!==(C=((R=(G=x[13].rating)==null?void 0:G.toFixed(2))!=null?R:"??.??")+"")&&L(w,C),x[13].clear!==null?E?E.p(x,F):(E=at(x),E.c(),E.m(V,null)):E&&(E.d(1),E=null),F&8&&te(t,"best30",x[13].rank<=30),F&8&&te(t,"best40",x[13].rank<=40)},d(x){x&&U(t),E&&E.d()}}}function Cn(e){let t,n,r=e[1]?"Show All":"Show B40",i,o,s,l,a=Object.keys(e[4])[e[2]]+"",c,u,f,_,A,y,P,d,p,O,T,C,w,k,V,B,E,N,de,Q,H,x,F;k=new Mt({props:{b30:We(e[5]),maxAchievable:Et(e[5]),playerStats:e[0]}});let se=["#","Title","Const.","Score","Rating","AJ"],I=[];for(let m=0;m<6;m+=1)I[m]=ct(lt(e,se,m));let G=e[3],R=[];for(let m=0;m<G.length;m+=1)R[m]=ut(st(e,G,m));return{c(){t=g("div"),n=g("button"),i=j(r),o=S(),s=g("button"),l=j("Sort: "),c=j(a),u=S(),f=g("button"),_=g("i"),A=j("Best 30"),P=S(),d=g("button"),p=g("i"),O=j("Best 40"),C=S(),w=g("main"),fe(k.$$.fragment),V=S(),B=g("table"),E=g("thead"),N=g("tr");for(let m=0;m<6;m+=1)I[m].c();de=S(),Q=g("tbody");for(let m=0;m<R.length;m+=1)R[m].c();v(n,"class","filter svelte-h7j0em"),v(s,"class","sort svelte-h7j0em"),v(_,"class","svelte-h7j0em"),v(f,"class","dl svelte-h7j0em"),f.disabled=y=e[2]!=0,v(p,"class","svelte-h7j0em"),v(d,"class","dl svelte-h7j0em"),d.disabled=T=e[2]!=0,v(t,"class","buttons"),v(Q,"class","svelte-h7j0em"),v(B,"class","svelte-h7j0em"),v(w,"class","svelte-h7j0em")},m(m,M){W(m,t,M),h(t,n),h(n,i),h(t,o),h(t,s),h(s,l),h(s,c),h(t,u),h(t,f),h(f,_),h(f,A),h(t,P),h(t,d),h(d,p),h(d,O),W(m,C,M),W(m,w,M),ne(k,w,null),h(w,V),h(w,B),h(B,E),h(E,N);for(let z=0;z<6;z+=1)I[z].m(N,null);h(B,de),h(B,Q);for(let z=0;z<R.length;z+=1)R[z].m(Q,null);H=!0,x||(F=[ce(n,"click",e[8]),ce(s,"click",e[9]),ce(f,"click",e[10]),ce(d,"click",e[11])],x=!0)},p(m,[M]){(!H||M&2)&&r!==(r=m[1]?"Show All":"Show B40")&&L(i,r),(!H||M&4)&&a!==(a=Object.keys(m[4])[m[2]]+"")&&L(c,a),(!H||M&4&&y!==(y=m[2]!=0))&&(f.disabled=y),(!H||M&4&&T!==(T=m[2]!=0))&&(d.disabled=T);const z={};if(M&1&&(z.playerStats=m[0]),k.$set(z),M&22){se=["#","Title","Const.","Score","Rating","AJ"];let b;for(b=0;b<6;b+=1){const me=lt(m,se,b);I[b]?I[b].p(me,M):(I[b]=ct(me),I[b].c(),I[b].m(N,null))}for(;b<6;b+=1)I[b].d(1)}if(M&8){G=m[3];let b;for(b=0;b<G.length;b+=1){const me=st(m,G,b);R[b]?R[b].p(me,M):(R[b]=ut(me),R[b].c(),R[b].m(Q,null))}for(;b<R.length;b+=1)R[b].d(1);R.length=G.length}},i(m){H||(J(k.$$.fragment,m),H=!0)},o(m){Z(k.$$.fragment,m),H=!1},d(m){m&&U(t),m&&U(C),m&&U(w),re(k),Ue(I,m),Ue(R,m),x=!1,ee(F)}}}function Ln(e,t,n){let r,i,{recordList:o}=t,{playerStats:s}=t,l=Ie(),a=0;const c={Rating:(d,p)=>p.rating-d.rating||p.const-d.const,Score:(d,p)=>p.score-d.score,"Const.":(d,p)=>p.const-d.const,Title:(d,p)=>{if(d.title<p.title)return-1;if(d.title>p.title)return 1;const O=["ULT","MAS","EXP","ADV","BAS"];return O.indexOf(p.difficulty)-O.indexOf(d.difficulty)},AJ:(d,p)=>{if(d.clear==p.clear)return p.rating-d.rating||p.const-d.const;const O=[null,"FC","AJ"];return O.indexOf(p.clear)-O.indexOf(d.clear)}},u=o.map(d=>d.rating),f=()=>{n(1,l=!l),l&&n(2,a=0)},_=()=>{n(2,a=(a+1)%Object.keys(c).length),n(1,l=!1)},A=()=>ot("b30"),y=()=>ot("b40"),P=d=>{let p=Object.keys(c).indexOf(d=="#"?"Rating":d);p>=0&&n(2,a=p),p>0&&n(1,l=!1)};return e.$$set=d=>{"recordList"in d&&n(6,o=d.recordList),"playerStats"in d&&n(0,s=d.playerStats)},e.$$.update=()=>{e.$$.dirty&68&&n(7,r=o.sort(Object.values(c)[a])),e.$$.dirty&130&&n(3,i=l?r.slice(0,40):r)},[s,l,a,i,c,u,o,r,f,_,A,y,P]}class An extends _e{constructor(t){super(),be(this,t,Ln,Cn,le,{recordList:6,playerStats:0},Pn)}}function On(e){ge(e,"svelte-17lywe3","body.svelte-17lywe3.svelte-17lywe3{padding-top:1rem;background-color:#113;color:#eec;margin:0;font-size:14px;min-height:100%;min-width:fit-content}body.svelte-17lywe3 a.svelte-17lywe3{color:#3cc;text-decoration:none}")}function Fn(e){let t,n;return t=new An({props:{recordList:e[1],playerStats:e[2]}}),{c(){fe(t.$$.fragment)},m(r,i){ne(t,r,i),n=!0},p(r,i){const o={};i&2&&(o.recordList=r[1]),i&4&&(o.playerStats=r[2]),t.$set(o)},i(r){n||(J(t.$$.fragment,r),n=!0)},o(r){Z(t.$$.fragment,r),n=!1},d(r){re(t,r)}}}function Dn(e){let t,n,r,i,o;return{c(){t=g("div"),n=g("p"),n.textContent="Loading...",r=S(),i=g("p"),o=j(e[3])},m(s,l){W(s,t,l),h(t,n),h(t,r),h(t,i),h(i,o)},p(s,l){l&8&&L(o,s[3])},i:q,o:q,d(s){s&&U(t)}}}function In(e){let t,n,r,i,o,s;const l=[Dn,Fn],a=[];function c(u,f){return u[0]?1:0}return i=c(e),o=a[i]=l[i](e),{c(){t=g("body"),n=g("div"),n.innerHTML=`<h3>Chunithm International Score Viewer</h3> 
        <a href="https://github.com/Dogeon188/chuni_new_intl_viewer" target="_blank" rel="noopener noreferrer" class="svelte-17lywe3">Dogeon188/chuni_new_intl_viewer@GitHub</a>`,r=S(),o.c(),v(t,"class","svelte-17lywe3")},m(u,f){W(u,t,f),h(t,n),h(t,r),a[i].m(t,null),s=!0},p(u,[f]){let _=i;i=c(u),i===_?a[i].p(u,f):(St(),Z(a[_],1,1,()=>{a[_]=null}),jt(),o=a[i],o?o.p(u,f):(o=a[i]=l[i](u),o.c()),J(o,1),o.m(t,null))},i(u){s||(J(o),s=!0)},o(u){Z(o),s=!1},d(u){u&&U(t),a[i].d()}}}function Mn(e,t,n){let r;gt(e,ye,l=>n(3,r=l));let i=!1,o=[],s;return(async()=>(n(1,o=await Pt()),n(2,s=await Ct()),n(0,i=!0)))(),[i,o,s,r]}class Bn extends _e{constructor(t){super(),be(this,t,Mn,In,le,{},On)}}async function Un(){if(window.chuniIntlViewer){alert("[chuni-intl-viewer] Please refresh the page before another new fetch.");return}if(window.chuniIntlViewer=!0,window.location.hostname!=="chunithm-net-eng.com"){alert("[chuni_intl_viewer] This tools could only be used under chunithm-net international."),window.location.href="https://chunithm-net-eng.com/";return}if(!De("_t")){alert("[chuni-intl-viewer] Token not found. Please login first."),window.location.href="https://chunithm-net-eng.com/";return}const e=document.body.attachShadow({mode:"open"});new Bn({target:e})}Un()})();
