(function(){"use strict";function ye(e){const t=document.cookie.split(";").map(n=>decodeURIComponent(n.trim())).map(n=>n.split("=")).find(n=>n[0]===e);return t?t[1]:""}function xe(){return/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)}function nt(e){return Number([...e].filter(t=>t!==",").join(""))}function B(){}function ke(e){return e()}function Se(){return Object.create(null)}function q(e){e.forEach(ke)}function rt(e){return typeof e=="function"}function Z(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}let N;function $e(e,t){return N||(N=document.createElement("a")),N.href=t,e===N.href}function it(e){return Object.keys(e).length===0}function h(e,t){e.appendChild(t)}function ee(e,t,n){const r=ot(e);if(!r.getElementById(t)){const i=g("style");i.id=t,i.textContent=n,ct(r,i)}}function ot(e){if(!e)return document;const t=e.getRootNode?e.getRootNode():e.ownerDocument;return t&&t.host?t:e.ownerDocument}function ct(e,t){h(e.head||e,t)}function P(e,t,n){e.insertBefore(t,n||null)}function T(e){e.parentNode.removeChild(e)}function st(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function g(e){return document.createElement(e)}function C(e){return document.createTextNode(e)}function y(){return C(" ")}function ae(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function m(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function lt(e){return Array.from(e.childNodes)}function U(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}let he;function K(e){he=e}const Q=[],je=[],te=[],Ee=[],ut=Promise.resolve();let de=!1;function ft(){de||(de=!0,ut.then(Te))}function me(e){te.push(e)}const ge=new Set;let ne=0;function Te(){const e=he;do{for(;ne<Q.length;){const t=Q[ne];ne++,K(t),at(t.$$)}for(K(null),Q.length=0,ne=0;je.length;)je.pop()();for(let t=0;t<te.length;t+=1){const n=te[t];ge.has(n)||(ge.add(n),n())}te.length=0}while(Q.length);for(;Ee.length;)Ee.pop()();de=!1,ge.clear(),K(e)}function at(e){if(e.fragment!==null){e.update(),q(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(me)}}const re=new Set;let O;function ht(){O={r:0,c:[],p:O}}function dt(){O.r||q(O.c),O=O.p}function L(e,t){e&&e.i&&(re.delete(e),e.i(t))}function M(e,t,n,r){if(e&&e.o){if(re.has(e))return;re.add(e),O.c.push(()=>{re.delete(e),r&&(n&&e.d(1),r())}),e.o(t)}}function G(e){e&&e.c()}function H(e,t,n,r){const{fragment:i,on_mount:o,on_destroy:c,after_update:a}=e.$$;i&&i.m(t,n),r||me(()=>{const l=o.map(ke).filter(rt);c?c.push(...l):q(l),e.$$.on_mount=[]}),a.forEach(me)}function V(e,t){const n=e.$$;n.fragment!==null&&(q(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function mt(e,t){e.$$.dirty[0]===-1&&(Q.push(e),ft(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function ie(e,t,n,r,i,o,c,a=[-1]){const l=he;K(e);const u=e.$$={fragment:null,ctx:null,props:o,update:B,not_equal:i,bound:Se(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(l?l.$$.context:[])),callbacks:Se(),dirty:a,skip_bound:!1,root:t.target||l.$$.root};c&&c(u.root);let s=!1;if(u.ctx=n?n(e,t.props||{},(f,p,...b)=>{const S=b.length?b[0]:p;return u.ctx&&i(u.ctx[f],u.ctx[f]=S)&&(!u.skip_bound&&u.bound[f]&&u.bound[f](S),s&&mt(e,f)),p}):[],u.update(),s=!0,q(u.before_update),u.fragment=r?r(u.ctx):!1,t.target){if(t.hydrate){const f=lt(t.target);u.fragment&&u.fragment.l(f),f.forEach(T)}else u.fragment&&u.fragment.c();t.intro&&L(e.$$.fragment),H(e,t.target,t.anchor,t.customElement),Te()}K(l)}class oe{$destroy(){V(this,1),this.$destroy=B}$on(t,n){const r=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return r.push(n),()=>{const i=r.indexOf(n);i!==-1&&r.splice(i,1)}}$set(t){this.$$set&&!it(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}function gt(e,t){t*=100;const n=[[101e4,t+215],[1009e3,t+215],[1007500,t+200],[1005e3,t+150],[1e6,t+100],[975e3,t],[925e3,t-300],[9e5,t-500],[8e5,(t-500)/2],[5e5,0]];let r=1;n.some((a,l)=>(r=l,e>a[0]));const i=n[r-1],o=n[r],c=o[1]+(i[1]-o[1])/(i[0]-o[0])*(e-o[0]);return Math.floor(c+Number.EPSILON)/100}function Re(e){return e.slice(0,30).reduce((t,n)=>t+n)/30}function pt(e){return(Re(e)*30+e[0]*10)/40}const F={ultima:"ULT",master:"MAS",expert:"EXP",advance:"ADV",basic:"BAS"};async function vt(e=F.master){const t=new FormData;t.append("genre","99"),t.append("token",ye("_t"));const n={[F.ultima]:"sendUltima",[F.master]:"sendMaster",[F.expert]:"sendExpert",[F.advance]:"sendAdvance",[F.basic]:"sendBasic"},i=await(await fetch(`https://chunithm-net-eng.com/mobile/record/musicGenre/${n[e]}`,{headers:{"Cache-Control":"no-cache"},method:"POST",body:t})).text(),o=[...$(i).find("form")];return o.shift(),o}async function wt(){const e=[];for(const t of Object.values(F))e.push(await vt(t));return e.flatMap((t,n)=>t.map(r=>{var a,l;const i=$(r),o=i.find(".play_musicdata_icon");let c=null;if(o.length){for(const u of["fullchain","fullchain2","alljustice","fullcombo"])if(o.find(`img[src*="${u}"]`).length){c=u;break}}return{title:(a=i.find(".music_title"))==null?void 0:a.text(),score:nt((l=i.find(".text_b"))==null?void 0:l.text()),difficulty:Object.values(F)[n],clear:c}}).filter(r=>r.title!==null&&r.score>0))}async function bt(){const e=await(await fetch("https://raw.githubusercontent.com/Dogeon188/chuni_new_intl_viewer/main/songData.json")).json(),t=await wt();return t.map(n=>{const r=e[n.title];if(r===void 0){alert(`[chuni-intl-viewer] Found unknown song "${n.title} ${n.difficulty}".
The data should be updating soon, please run chuni-viewer again later to get proper song data.`),fetch(new Request("https://chuniupdate.dogeon188.repl.co/sendUpdate",{method:"POST"})),n.const=0,n.rating=0;return}n.const=r[n.difficulty],n.rating=gt(n.score,n.const)}),t.sort((n,r)=>r.rating-n.rating||r.const-n.const),t}function _t(e){ee(e,"svelte-1yzwp8z","dt.svelte-1yzwp8z{font-size:0.3em;color:#c9e}dd.svelte-1yzwp8z{margin-inline-start:1em}")}function yt(e){let t,n,r,i,o,c;return{c(){t=g("div"),n=g("dt"),r=C(e[0]),i=y(),o=g("dd"),c=C(e[1]),m(n,"class","svelte-1yzwp8z"),m(o,"class","svelte-1yzwp8z")},m(a,l){P(a,t,l),h(t,n),h(n,r),h(t,i),h(t,o),h(o,c)},p(a,[l]){l&1&&U(r,a[0]),l&2&&U(c,a[1])},i:B,o:B,d(a){a&&T(t)}}}function xt(e,t,n){let{title:r}=t,{content:i}=t;return e.$$set=o=>{"title"in o&&n(0,r=o.title),"content"in o&&n(1,i=o.content)},[r,i]}class ce extends oe{constructor(t){super(),ie(this,t,xt,yt,Z,{title:0,content:1},_t)}}function kt(e){ee(e,"svelte-16q7hki","div.svelte-16q7hki{border:#536 3px solid;border-radius:0.5em;background-color:#324;width:fit-content;padding:0.5em;margin:0.5em;text-align:left}")}function St(e){let t,n,r,i,o,c,a,l,u;return n=new ce({props:{title:"Generated at",content:new Date().toLocaleDateString()}}),i=new ce({props:{title:"Best 30 Avg.",content:e[0].toFixed(2)}}),c=new ce({props:{title:"Max Achievable",content:e[1].toFixed(2)}}),l=new ce({props:{title:"Total MAS Score",content:e[2].toString()}}),{c(){t=g("div"),G(n.$$.fragment),r=y(),G(i.$$.fragment),o=y(),G(c.$$.fragment),a=y(),G(l.$$.fragment),m(t,"class","svelte-16q7hki")},m(s,f){P(s,t,f),H(n,t,null),h(t,r),H(i,t,null),h(t,o),H(c,t,null),h(t,a),H(l,t,null),u=!0},p(s,[f]){const p={};f&1&&(p.content=s[0].toFixed(2)),i.$set(p);const b={};f&2&&(b.content=s[1].toFixed(2)),c.$set(b);const S={};f&4&&(S.content=s[2].toString()),l.$set(S)},i(s){u||(L(n.$$.fragment,s),L(i.$$.fragment,s),L(c.$$.fragment,s),L(l.$$.fragment,s),u=!0)},o(s){M(n.$$.fragment,s),M(i.$$.fragment,s),M(c.$$.fragment,s),M(l.$$.fragment,s),u=!1},d(s){s&&T(t),V(n),V(i),V(c),V(l)}}}function $t(e,t,n){let{b30:r}=t,{maxAchievable:i}=t,{totalMasterScore:o}=t;return e.$$set=c=>{"b30"in c&&n(0,r=c.b30),"maxAchievable"in c&&n(1,i=c.maxAchievable),"totalMasterScore"in c&&n(2,o=c.totalMasterScore)},[r,i,o]}class jt extends oe{constructor(t){super(),ie(this,t,$t,St,Z,{b30:0,maxAchievable:1,totalMasterScore:2},kt)}}var Pe=globalThis&&globalThis.__awaiter||function(e,t,n,r){function i(o){return o instanceof n?o:new n(function(c){c(o)})}return new(n||(n=Promise))(function(o,c){function a(s){try{u(r.next(s))}catch(f){c(f)}}function l(s){try{u(r.throw(s))}catch(f){c(f)}}function u(s){s.done?o(s.value):i(s.value).then(a,l)}u((r=r.apply(e,t||[])).next())})};const Ce="application/font-woff",Le="image/jpeg",Et={woff:Ce,woff2:Ce,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:Le,jpeg:Le,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml"};function Tt(e){const t=/\.([^./]*?)$/g.exec(e);return t?t[1]:""}function se(e){const t=Tt(e).toLowerCase();return Et[t]||""}function Rt(e,t){if(e.match(/^[a-z]+:\/\//i))return e;if(e.match(/^\/\//))return window.location.protocol+e;if(e.match(/^[a-z]+:/i))return e;const n=document.implementation.createHTMLDocument(),r=n.createElement("base"),i=n.createElement("a");return n.head.appendChild(r),n.body.appendChild(i),t&&(r.href=t),i.href=e,i.href}function pe(e){return e.search(/^(data:)/)!==-1}function le(e,t){return`data:${t};base64,${e}`}function Pt(e){return e.split(/,/)[1]}const Ct=function(){let t=0;const n=()=>`0000${(Math.random()*Math.pow(36,4)<<0).toString(36)}`.slice(-4);return()=>(t+=1,`u${n()}${t}`)}();function I(e){const t=[];for(let n=0,r=e.length;n<r;n+=1)t.push(e[n]);return t}function ue(e,t){const n=window.getComputedStyle(e).getPropertyValue(t);return parseFloat(n.replace("px",""))}function Lt(e){const t=ue(e,"border-left-width"),n=ue(e,"border-right-width");return e.clientWidth+t+n}function At(e){const t=ue(e,"border-top-width"),n=ue(e,"border-bottom-width");return e.clientHeight+t+n}function Mt(){let e,t;try{t=process}catch{}const n=t&&t.env?t.env.devicePixelRatio:null;return n&&(e=parseInt(n,10),Number.isNaN(e)&&(e=1)),e||window.devicePixelRatio||1}function Ft(e){return e.toBlob?new Promise(t=>e.toBlob(t)):new Promise(t=>{const n=window.atob(e.toDataURL().split(",")[1]),r=n.length,i=new Uint8Array(r);for(let o=0;o<r;o+=1)i[o]=n.charCodeAt(o);t(new Blob([i],{type:"image/png"}))})}function ve(e){return new Promise((t,n)=>{const r=new Image;r.onload=()=>t(r),r.onerror=n,r.crossOrigin="anonymous",r.decoding="sync",r.src=e})}function It(e){return Pe(this,void 0,void 0,function*(){return Promise.resolve().then(()=>new XMLSerializer().serializeToString(e)).then(encodeURIComponent).then(t=>`data:image/svg+xml;charset=utf-8,${t}`)})}function Dt(e,t,n){return Pe(this,void 0,void 0,function*(){const r="http://www.w3.org/2000/svg",i=document.createElementNS(r,"svg"),o=document.createElementNS(r,"foreignObject");return i.setAttribute("width",`${t}`),i.setAttribute("height",`${n}`),i.setAttribute("viewBox",`0 0 ${t} ${n}`),o.setAttribute("width","100%"),o.setAttribute("height","100%"),o.setAttribute("x","0"),o.setAttribute("y","0"),o.setAttribute("externalResourcesRequired","true"),i.appendChild(o),o.appendChild(e),It(i)})}const we={};function Bt(e){let t=e.replace(/\?.*/,"");return/ttf|otf|eot|woff2?/i.test(t)&&(t=t.replace(/.*\//,"")),t}function be(e,t){const n=Bt(e);if(we[n]!=null)return we[n];t.cacheBust&&(e+=(/\?/.test(e)?"&":"?")+new Date().getTime());const r=o=>{let c="";if(t.imagePlaceholder){const l=t.imagePlaceholder.split(/,/);l&&l[1]&&(c=l[1])}let a=`Failed to fetch resource: ${e}`;return o&&(a=typeof o=="string"?o:o.message),a&&console.error(a),{blob:c,contentType:""}},i=window.fetch(e).then(o=>o.blob().then(c=>({blob:c,contentType:o.headers.get("Content-Type")||""}))).then(({blob:o,contentType:c})=>new Promise((a,l)=>{const u=new FileReader;u.onloadend=()=>a({contentType:c,blob:u.result}),u.onerror=l,u.readAsDataURL(o)})).then(({blob:o,contentType:c})=>({contentType:c,blob:Pt(o)})).catch(r);return we[n]=i,i}function Ut(e){const t=e.getPropertyValue("content");return`${e.cssText} content: '${t.replace(/'|"/g,"")}';`}function Ot(e){return I(e).map(t=>{const n=e.getPropertyValue(t),r=e.getPropertyPriority(t);return`${t}: ${n}${r?" !important":""};`}).join(" ")}function Ht(e,t,n){const r=`.${e}:${t}`,i=n.cssText?Ut(n):Ot(n);return document.createTextNode(`${r}{${i}}`)}function Ae(e,t,n){const r=window.getComputedStyle(e,n),i=r.getPropertyValue("content");if(i===""||i==="none")return;const o=Ct();try{t.className=`${t.className} ${o}`}catch{return}const c=document.createElement("style");c.appendChild(Ht(o,n,r)),t.appendChild(c)}function Vt(e,t){Ae(e,t,":before"),Ae(e,t,":after")}var X=globalThis&&globalThis.__awaiter||function(e,t,n,r){function i(o){return o instanceof n?o:new n(function(c){c(o)})}return new(n||(n=Promise))(function(o,c){function a(s){try{u(r.next(s))}catch(f){c(f)}}function l(s){try{u(r.throw(s))}catch(f){c(f)}}function u(s){s.done?o(s.value):i(s.value).then(a,l)}u((r=r.apply(e,t||[])).next())})};function zt(e){return X(this,void 0,void 0,function*(){const t=e.toDataURL();return t==="data:,"?Promise.resolve(e.cloneNode(!1)):ve(t)})}function Wt(e,t){return X(this,void 0,void 0,function*(){return Promise.resolve(e.poster).then(n=>be(n,t)).then(n=>le(n.blob,se(e.poster)||n.contentType)).then(n=>ve(n))})}function qt(e,t){return X(this,void 0,void 0,function*(){return e instanceof HTMLCanvasElement?zt(e):e instanceof HTMLVideoElement&&e.poster?Wt(e,t):Promise.resolve(e.cloneNode(!1))})}const Gt=e=>e.tagName!=null&&e.tagName.toUpperCase()==="SLOT";function Xt(e,t,n){var r;return X(this,void 0,void 0,function*(){const i=Gt(e)&&e.assignedNodes?I(e.assignedNodes()):I(((r=e.shadowRoot)!==null&&r!==void 0?r:e).childNodes);return i.length===0||e instanceof HTMLVideoElement?Promise.resolve(t):i.reduce((o,c)=>o.then(()=>Me(c,n)).then(a=>{a&&t.appendChild(a)}),Promise.resolve()).then(()=>t)})}function Jt(e,t){const n=window.getComputedStyle(e),r=t.style;!r||(n.cssText?r.cssText=n.cssText:I(n).forEach(i=>{r.setProperty(i,n.getPropertyValue(i),n.getPropertyPriority(i))}))}function Kt(e,t){e instanceof HTMLTextAreaElement&&(t.innerHTML=e.value),e instanceof HTMLInputElement&&t.setAttribute("value",e.value)}function Qt(e,t){return X(this,void 0,void 0,function*(){return t instanceof Element?Promise.resolve().then(()=>Jt(e,t)).then(()=>Vt(e,t)).then(()=>Kt(e,t)).then(()=>t):Promise.resolve(t)})}function Me(e,t,n){return X(this,void 0,void 0,function*(){return!n&&t.filter&&!t.filter(e)?Promise.resolve(null):Promise.resolve(e).then(r=>qt(r,t)).then(r=>Xt(e,r,t)).then(r=>Qt(e,r))})}var Yt=globalThis&&globalThis.__awaiter||function(e,t,n,r){function i(o){return o instanceof n?o:new n(function(c){c(o)})}return new(n||(n=Promise))(function(o,c){function a(s){try{u(r.next(s))}catch(f){c(f)}}function l(s){try{u(r.throw(s))}catch(f){c(f)}}function u(s){s.done?o(s.value):i(s.value).then(a,l)}u((r=r.apply(e,t||[])).next())})};const Fe=/url\((['"]?)([^'"]+?)\1\)/g,Zt=/url\([^)]+\)\s*format\((["'])([^"']+)\1\)/g,Nt=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function en(e){const t=e.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1");return new RegExp(`(url\\(['"]?)(${t})(['"]?\\))`,"g")}function tn(e){const t=[];return e.replace(Fe,(n,r,i)=>(t.push(i),n)),t.filter(n=>!pe(n))}function nn(e,t,n,r,i){const o=n?Rt(t,n):t;return Promise.resolve(o).then(c=>i?i(c):be(c,r)).then(c=>typeof c=="string"?le(c,se(t)):le(c.blob,se(t)||c.contentType)).then(c=>e.replace(en(t),`$1${c}$3`)).then(c=>c,()=>o)}function rn(e,{preferredFontFormat:t}){return t?e.replace(Nt,n=>{for(;;){const[r,,i]=Zt.exec(n)||[];if(!i)return"";if(i===t)return`src: ${r};`}}):e}function Ie(e){return e.search(Fe)!==-1}function De(e,t,n){return Yt(this,void 0,void 0,function*(){if(!Ie(e))return Promise.resolve(e);const r=rn(e,n);return Promise.resolve(r).then(tn).then(i=>i.reduce((o,c)=>o.then(a=>nn(a,c,t,n)),Promise.resolve(r)))})}var fe=globalThis&&globalThis.__awaiter||function(e,t,n,r){function i(o){return o instanceof n?o:new n(function(c){c(o)})}return new(n||(n=Promise))(function(o,c){function a(s){try{u(r.next(s))}catch(f){c(f)}}function l(s){try{u(r.throw(s))}catch(f){c(f)}}function u(s){s.done?o(s.value):i(s.value).then(a,l)}u((r=r.apply(e,t||[])).next())})};function on(e,t){var n;return fe(this,void 0,void 0,function*(){const r=(n=e.style)===null||n===void 0?void 0:n.getPropertyValue("background");return r?Promise.resolve(r).then(i=>De(i,null,t)).then(i=>(e.style.setProperty("background",i,e.style.getPropertyPriority("background")),e)):Promise.resolve(e)})}function cn(e,t){return fe(this,void 0,void 0,function*(){if(!(e instanceof HTMLImageElement&&!pe(e.src))&&!(e instanceof SVGImageElement&&!pe(e.href.baseVal)))return Promise.resolve(e);const n=e instanceof HTMLImageElement?e.src:e.href.baseVal;return Promise.resolve(n).then(r=>be(r,t)).then(r=>le(r.blob,se(n)||r.contentType)).then(r=>new Promise((i,o)=>{e.onload=i,e.onerror=o,e instanceof HTMLImageElement?(e.srcset="",e.src=r):e.href.baseVal=r})).then(()=>e,()=>e)})}function sn(e,t){return fe(this,void 0,void 0,function*(){const r=I(e.childNodes).map(i=>Be(i,t));return Promise.all(r).then(()=>e)})}function Be(e,t){return fe(this,void 0,void 0,function*(){return e instanceof Element?Promise.resolve(e).then(n=>on(n,t)).then(n=>cn(n,t)).then(n=>sn(n,t)):Promise.resolve(e)})}function ln(e,t){const{style:n}=e;t.backgroundColor&&(n.backgroundColor=t.backgroundColor),t.width&&(n.width=`${t.width}px`),t.height&&(n.height=`${t.height}px`);const r=t.style;return r!=null&&Object.keys(r).forEach(i=>{n[i]=r[i]}),e}var Y=globalThis&&globalThis.__awaiter||function(e,t,n,r){function i(o){return o instanceof n?o:new n(function(c){c(o)})}return new(n||(n=Promise))(function(o,c){function a(s){try{u(r.next(s))}catch(f){c(f)}}function l(s){try{u(r.throw(s))}catch(f){c(f)}}function u(s){s.done?o(s.value):i(s.value).then(a,l)}u((r=r.apply(e,t||[])).next())})};const Ue={};function Oe(e){const t=Ue[e];if(t!=null)return t;const n=window.fetch(e).then(r=>({url:e,cssText:r.text()}));return Ue[e]=n,n}function He(e){return Y(this,void 0,void 0,function*(){return e.cssText.then(t=>{let n=t;const r=/url\(["']?([^"')]+)["']?\)/g,o=(n.match(/url\([^)]+\)/g)||[]).map(c=>{let a=c.replace(r,"$1");return a.startsWith("https://")||(a=new URL(a,e.url).href),window.fetch(a).then(l=>l.blob()).then(l=>new Promise((u,s)=>{const f=new FileReader;f.onloadend=()=>{n=n.replace(c,`url(${f.result})`),u([c,f.result])},f.onerror=s,f.readAsDataURL(l)}))});return Promise.all(o).then(()=>n)})})}function Ve(e){if(e==null)return[];const t=[],n=/(\/\*[\s\S]*?\*\/)/gi;let r=e.replace(n,"");const i=new RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");for(;;){const l=i.exec(r);if(l===null)break;t.push(l[0])}r=r.replace(i,"");const o=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,c="((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})",a=new RegExp(c,"gi");for(;;){let l=o.exec(r);if(l===null){if(l=a.exec(r),l===null)break;o.lastIndex=a.lastIndex}else a.lastIndex=o.lastIndex;t.push(l[0])}return t}function un(e){return Y(this,void 0,void 0,function*(){const t=[],n=[];return e.forEach(r=>{if("cssRules"in r)try{I(r.cssRules).forEach((i,o)=>{if(i.type===CSSRule.IMPORT_RULE){let c=o+1;const a=i.href,l=Oe(a).then(u=>u?He(u):"").then(u=>Ve(u).forEach(s=>{try{r.insertRule(s,s.startsWith("@import")?c+=1:r.cssRules.length)}catch(f){console.error("Error inserting rule from remote css",{rule:s,error:f})}})).catch(u=>{console.error("Error loading remote css",u.toString())});n.push(l)}})}catch(i){const o=e.find(c=>c.href==null)||document.styleSheets[0];r.href!=null&&n.push(Oe(r.href).then(c=>c?He(c):"").then(c=>Ve(c).forEach(a=>{o.insertRule(a,r.cssRules.length)})).catch(c=>{console.error("Error loading remote stylesheet",c.toString())})),console.error("Error inlining remote css file",i.toString())}}),Promise.all(n).then(()=>(e.forEach(r=>{if("cssRules"in r)try{I(r.cssRules).forEach(i=>{t.push(i)})}catch(i){console.error(`Error while reading CSS rules from ${r.href}`,i.toString())}}),t))})}function fn(e){return e.filter(t=>t.type===CSSRule.FONT_FACE_RULE).filter(t=>Ie(t.style.getPropertyValue("src")))}function an(e){return Y(this,void 0,void 0,function*(){return new Promise((t,n)=>{e.ownerDocument==null&&n(new Error("Provided element is not within a Document")),t(I(e.ownerDocument.styleSheets))}).then(t=>un(t)).then(fn)})}function hn(e,t){return Y(this,void 0,void 0,function*(){return an(e).then(n=>Promise.all(n.map(r=>{const i=r.parentStyleSheet?r.parentStyleSheet.href:null;return De(r.cssText,i,t)}))).then(n=>n.join(`
`))})}function dn(e,t){return Y(this,void 0,void 0,function*(){return(t.fontEmbedCSS!=null?Promise.resolve(t.fontEmbedCSS):hn(e,t)).then(n=>{const r=document.createElement("style"),i=document.createTextNode(n);return r.appendChild(i),e.firstChild?e.insertBefore(r,e.firstChild):e.appendChild(r),e})})}var _e=globalThis&&globalThis.__awaiter||function(e,t,n,r){function i(o){return o instanceof n?o:new n(function(c){c(o)})}return new(n||(n=Promise))(function(o,c){function a(s){try{u(r.next(s))}catch(f){c(f)}}function l(s){try{u(r.throw(s))}catch(f){c(f)}}function u(s){s.done?o(s.value):i(s.value).then(a,l)}u((r=r.apply(e,t||[])).next())})};function ze(e,t={}){const n=t.width||Lt(e),r=t.height||At(e);return{width:n,height:r}}function mn(e,t={}){return _e(this,void 0,void 0,function*(){const{width:n,height:r}=ze(e,t);return Promise.resolve(e).then(i=>Me(i,t,!0)).then(i=>dn(i,t)).then(i=>Be(i,t)).then(i=>ln(i,t)).then(i=>Dt(i,n,r))})}const x=16384;function gn(e){(e.width>x||e.height>x)&&(e.width>x&&e.height>x?e.width>e.height?(e.height*=x/e.width,e.width=x):(e.width*=x/e.height,e.height=x):e.width>x?(e.height*=x/e.width,e.width=x):(e.width*=x/e.height,e.height=x))}function pn(e,t={}){return _e(this,void 0,void 0,function*(){return mn(e,t).then(ve).then(n=>{const r=document.createElement("canvas"),i=r.getContext("2d"),o=t.pixelRatio||Mt(),{width:c,height:a}=ze(e,t),l=t.canvasWidth||c,u=t.canvasHeight||a;return r.width=l*o,r.height=u*o,t.skipAutoScale||gn(r),r.style.width=`${l}`,r.style.height=`${u}`,t.backgroundColor&&(i.fillStyle=t.backgroundColor,i.fillRect(0,0,r.width,r.height)),i.drawImage(n,0,0,r.width,r.height),r})})}function vn(e,t={}){return _e(this,void 0,void 0,function*(){return pn(e,t).then(Ft)})}async function wn(e){var r,i;const t=(r=document.body.shadowRoot)==null?void 0:r.querySelector("main");let n=t==null?void 0:t.cloneNode(!0);(i=t==null?void 0:t.parentElement)==null||i.appendChild(n),n.querySelectorAll("tr").forEach((o,c)=>{c>(e=="b30"?30:40)&&o.remove()}),vn(n,{backgroundColor:"#223"}).then(async o=>{if(n.remove(),o==null)return alert("[chuni-intl-viewer] Something went wrong when converting your scores to PNG. Please ask the author to fix it.");if(xe()){const c=new File([o],`result_${e}.png`,{type:o.type});navigator!=null&&navigator.canShare({files:[c]})&&navigator.share({files:[c],text:"#CHUNITHM"}).catch(console.log)}else $("<a>").attr({download:`result_${e}.png`,href:window.URL.createObjectURL(o)})[0].click()})}async function We(e,t){$(e.currentTarget).fadeTo(100,.5),await wn(t),$(e.currentTarget).fadeTo(100,1)}function bn(e){ee(e,"svelte-xm1jfk","button.svelte-xm1jfk.svelte-xm1jfk{margin:0.5em;padding:0.3em;font-family:inherit;font-weight:bold;background-color:#324;border:#536 3px solid;color:#eec;border-radius:0.3em;cursor:pointer}button.filter.svelte-xm1jfk.svelte-xm1jfk{border-color:#48c;background-color:#159;width:9em}button.dl.svelte-xm1jfk i.svelte-xm1jfk{background-image:url(https://raw.githubusercontent.com/Dogeon188/chuni_new_intl_viewer/main/assets/dl.png);display:inline-block;width:1em;height:1em;background-position:0px 0px;background-size:cover}table.svelte-xm1jfk.svelte-xm1jfk{border-spacing:0;padding-bottom:1em;width:100%}td.svelte-xm1jfk.svelte-xm1jfk,th.svelte-xm1jfk.svelte-xm1jfk{padding:0.5em}tbody.svelte-xm1jfk tr:nth-child(-n+30) td.svelte-xm1jfk:first-child{color:#fc4}tbody.svelte-xm1jfk tr:nth-child(-n+40) td.svelte-xm1jfk:first-child{font-weight:bold}tbody.svelte-xm1jfk tr.svelte-xm1jfk:nth-child(odd){background-color:#324}tbody.svelte-xm1jfk tr td.svelte-xm1jfk:nth-child(2){font-weight:bold}tbody.svelte-xm1jfk tr td:nth-child(2).diff-ult.svelte-xm1jfk{color:#3cf}tbody.svelte-xm1jfk tr td:nth-child(2).diff-mas.svelte-xm1jfk{color:#e9f}tbody.svelte-xm1jfk tr td:nth-child(2).diff-exp.svelte-xm1jfk{color:#e46}tbody.svelte-xm1jfk tr td:nth-child(2).diff-adv.svelte-xm1jfk{color:#e73}tbody.svelte-xm1jfk tr td:nth-child(2).diff-bas.svelte-xm1jfk{color:#1c3}")}function qe(e,t,n){const r=e.slice();return r[8]=t[n],r[10]=n,r}function Ge(e){let t,n,r;return{c(){t=g("img"),$e(t.src,n="https://chunithm-net-eng.com/mobile/images/icon_"+e[8].clear+".png")||m(t,"src",n),m(t,"alt",r=e[8].clear)},m(i,o){P(i,t,o)},p(i,o){o&2&&!$e(t.src,n="https://chunithm-net-eng.com/mobile/images/icon_"+i[8].clear+".png")&&m(t,"src",n),o&2&&r!==(r=i[8].clear)&&m(t,"alt",r)},d(i){i&&T(t)}}}function Xe(e){var Je,Ke,Qe,Ye;let t,n,r=e[10]+1+"",i,o,c,a=e[8].title+"",l,u,s,f,p=((Ke=(Je=e[8].const)==null?void 0:Je.toFixed(1))!=null?Ke:"??.?")+"",b,S,z,R=e[8].score+"",A,J,W,E=((Ye=(Qe=e[8].rating)==null?void 0:Qe.toFixed(2))!=null?Ye:"??.??")+"",w,d,k,v,_=e[8].clear!==null&&Ge(e);return{c(){t=g("tr"),n=g("td"),i=C(r),o=y(),c=g("td"),l=C(a),s=y(),f=g("td"),b=C(p),S=y(),z=g("td"),A=C(R),J=y(),W=g("td"),w=C(E),d=y(),k=g("td"),_&&_.c(),v=y(),m(n,"class","svelte-xm1jfk"),m(c,"class",u="diff-"+e[8].difficulty.toLowerCase()+" svelte-xm1jfk"),m(f,"class","svelte-xm1jfk"),m(z,"class","svelte-xm1jfk"),m(W,"class","svelte-xm1jfk"),m(k,"class","svelte-xm1jfk"),m(t,"class","svelte-xm1jfk")},m(j,D){P(j,t,D),h(t,n),h(n,i),h(t,o),h(t,c),h(c,l),h(t,s),h(t,f),h(f,b),h(t,S),h(t,z),h(z,A),h(t,J),h(t,W),h(W,w),h(t,d),h(t,k),_&&_.m(k,null),h(t,v)},p(j,D){var Ze,Ne,et,tt;D&2&&a!==(a=j[8].title+"")&&U(l,a),D&2&&u!==(u="diff-"+j[8].difficulty.toLowerCase()+" svelte-xm1jfk")&&m(c,"class",u),D&2&&p!==(p=((Ne=(Ze=j[8].const)==null?void 0:Ze.toFixed(1))!=null?Ne:"??.?")+"")&&U(b,p),D&2&&R!==(R=j[8].score+"")&&U(A,R),D&2&&E!==(E=((tt=(et=j[8].rating)==null?void 0:et.toFixed(2))!=null?tt:"??.??")+"")&&U(w,E),j[8].clear!==null?_?_.p(j,D):(_=Ge(j),_.c(),_.m(k,null)):_&&(_.d(1),_=null)},d(j){j&&T(t),_&&_.d()}}}function _n(e){let t,n,r=e[0]?"Show All":"Show Best 40",i,o,c,a,l,u,s,f,p,b,S,z,R,A,J,W;f=new jt({props:{b30:Re(e[2]),maxAchievable:pt(e[2]),totalMasterScore:e[3]}});let E=e[1],w=[];for(let d=0;d<E.length;d+=1)w[d]=Xe(qe(e,E,d));return{c(){t=g("div"),n=g("button"),i=C(r),o=y(),c=g("button"),c.innerHTML='<i class="svelte-xm1jfk"></i>Best 30',a=y(),l=g("button"),l.innerHTML='<i class="svelte-xm1jfk"></i>Best 40',u=y(),s=g("main"),G(f.$$.fragment),p=y(),b=g("table"),S=g("thead"),S.innerHTML=`<tr><th class="svelte-xm1jfk">#</th> 
            <th class="svelte-xm1jfk">Song Name</th> 
            <th class="svelte-xm1jfk">Constant</th> 
            <th class="svelte-xm1jfk">Score</th> 
            <th class="svelte-xm1jfk">Rating</th> 
            <th class="svelte-xm1jfk">FC/AJ</th></tr>`,z=y(),R=g("tbody");for(let d=0;d<w.length;d+=1)w[d].c();m(n,"class","filter svelte-xm1jfk"),m(c,"class","dl svelte-xm1jfk"),m(l,"class","dl svelte-xm1jfk"),m(t,"class","buttons"),m(R,"class","svelte-xm1jfk"),m(b,"id","chuni-result-table"),m(b,"class","svelte-xm1jfk"),m(s,"id","chuni-viewer-main")},m(d,k){P(d,t,k),h(t,n),h(n,i),h(t,o),h(t,c),h(t,a),h(t,l),P(d,u,k),P(d,s,k),H(f,s,null),h(s,p),h(s,b),h(b,S),h(b,z),h(b,R);for(let v=0;v<w.length;v+=1)w[v].m(R,null);A=!0,J||(W=[ae(n,"click",e[5]),ae(c,"click",e[6]),ae(l,"click",e[7])],J=!0)},p(d,[k]){if((!A||k&1)&&r!==(r=d[0]?"Show All":"Show Best 40")&&U(i,r),k&2){E=d[1];let v;for(v=0;v<E.length;v+=1){const _=qe(d,E,v);w[v]?w[v].p(_,k):(w[v]=Xe(_),w[v].c(),w[v].m(R,null))}for(;v<w.length;v+=1)w[v].d(1);w.length=E.length}},i(d){A||(L(f.$$.fragment,d),A=!0)},o(d){M(f.$$.fragment,d),A=!1},d(d){d&&T(t),d&&T(u),d&&T(s),V(f),st(w,d),J=!1,q(W)}}}function yn(e,t,n){let r,{recordList:i}=t,o=xe();const c=i.map(f=>f.rating),a=i.filter(f=>f.difficulty==="MAS").map(f=>f.score).reduce((f,p)=>f+p),l=()=>{n(0,o=!o)},u=f=>We(f,"b30"),s=f=>We(f,"b40");return e.$$set=f=>{"recordList"in f&&n(4,i=f.recordList)},e.$$.update=()=>{e.$$.dirty&17&&n(1,r=o?i.slice(0,40):i)},[o,r,c,a,i,l,u,s]}class xn extends oe{constructor(t){super(),ie(this,t,yn,_n,Z,{recordList:4},bn)}}function kn(e){ee(e,"svelte-32edj0","body.svelte-32edj0.svelte-32edj0{padding:0.1em;background-color:#223;color:#eec;margin:0;min-height:100%;min-width:fit-content}body.svelte-32edj0 a.svelte-32edj0{color:#3cc;text-decoration:none}")}function Sn(e){let t,n;return t=new xn({props:{recordList:e[1]}}),{c(){G(t.$$.fragment)},m(r,i){H(t,r,i),n=!0},p(r,i){const o={};i&2&&(o.recordList=r[1]),t.$set(o)},i(r){n||(L(t.$$.fragment,r),n=!0)},o(r){M(t.$$.fragment,r),n=!1},d(r){V(t,r)}}}function $n(e){let t;return{c(){t=g("div"),t.textContent="Loading...",m(t,"id","chuni-msg")},m(n,r){P(n,t,r)},p:B,i:B,o:B,d(n){n&&T(t)}}}function jn(e){let t,n,r,i,o,c;const a=[$n,Sn],l=[];function u(s,f){return s[0]?1:0}return i=u(e),o=l[i]=a[i](e),{c(){t=g("body"),n=g("div"),n.innerHTML=`<h3>Chunithm International Score Viewer</h3> 
        <a href="https://github.com/Dogeon188/chuni_new_intl_viewer" target="_blank" rel="noopener noreferrer" class="svelte-32edj0">Dogeon188/chuni_new_intl_viewer@GitHub</a>`,r=y(),o.c(),m(t,"class","svelte-32edj0")},m(s,f){P(s,t,f),h(t,n),h(t,r),l[i].m(t,null),c=!0},p(s,[f]){let p=i;i=u(s),i===p?l[i].p(s,f):(ht(),M(l[p],1,1,()=>{l[p]=null}),dt(),o=l[i],o?o.p(s,f):(o=l[i]=a[i](s),o.c()),L(o,1),o.m(t,null))},i(s){c||(L(o),c=!0)},o(s){M(o),c=!1},d(s){s&&T(t),l[i].d()}}}function En(e,t,n){let r=!1,i=[];return(async()=>(n(1,i=await bt()),n(0,r=!0)))(),[r,i]}class Tn extends oe{constructor(t){super(),ie(this,t,En,jn,Z,{},kn)}}async function Rn(){if(window.chuniIntlViewer){alert("[chuni-intl-viewer] Please refresh the page before another new fetch.");return}if(window.chuniIntlViewer=!0,window.location.hostname!=="chunithm-net-eng.com"){alert("[chuni_intl_viewer] This tools could only be used under chunithm-net international."),window.location.href="https://chunithm-net-eng.com/";return}if(!ye("_t")){alert("[chuni-intl-viewer] Token not found. Please login first."),window.location.href="https://chunithm-net-eng.com/";return}const e=document.body.attachShadow({mode:"open"});new Tn({target:e})}Rn()})();
