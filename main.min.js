(function(){"use strict";function Ee(e){const t=document.cookie.split(";").map(n=>decodeURIComponent(n.trim())).map(n=>n.split("=")).find(n=>n[0]===e);return t?t[1]:""}function lt(){return/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)}function ct(e){return Number([...e].filter(t=>t!==",").join(""))}function z(){}function Re(e){return e()}function Pe(){return Object.create(null)}function K(e){e.forEach(Re)}function Ce(e){return typeof e=="function"}function oe(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}let le;function Le(e,t){return le||(le=document.createElement("a")),le.href=t,e===le.href}function st(e){return Object.keys(e).length===0}function Ae(e){return e==null?"":e}function d(e,t){e.appendChild(t)}function ce(e,t,n){const r=ut(e);if(!r.getElementById(t)){const i=p("style");i.id=t,i.textContent=n,at(r,i)}}function ut(e){if(!e)return document;const t=e.getRootNode?e.getRootNode():e.ownerDocument;return t&&t.host?t:e.ownerDocument}function at(e,t){d(e.head||e,t)}function M(e,t,n){e.insertBefore(t,n||null)}function A(e){e.parentNode.removeChild(e)}function Me(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function p(e){return document.createElement(e)}function C(e){return document.createTextNode(e)}function _(){return C(" ")}function te(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function v(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function ft(e){return Array.from(e.childNodes)}function D(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}let we;function ne(e){we=e}const re=[],Oe=[],se=[],Fe=[],ht=Promise.resolve();let be=!1;function dt(){be||(be=!0,ht.then(Ie))}function ye(e){se.push(e)}const _e=new Set;let ue=0;function Ie(){const e=we;do{for(;ue<re.length;){const t=re[ue];ue++,ne(t),gt(t.$$)}for(ne(null),re.length=0,ue=0;Oe.length;)Oe.pop()();for(let t=0;t<se.length;t+=1){const n=se[t];_e.has(n)||(_e.add(n),n())}se.length=0}while(re.length);for(;Fe.length;)Fe.pop()();be=!1,_e.clear(),ne(e)}function gt(e){if(e.fragment!==null){e.update(),K(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(ye)}}const ae=new Set;let G;function mt(){G={r:0,c:[],p:G}}function pt(){G.r||K(G.c),G=G.p}function F(e,t){e&&e.i&&(ae.delete(e),e.i(t))}function B(e,t,n,r){if(e&&e.o){if(ae.has(e))return;ae.add(e),G.c.push(()=>{ae.delete(e),r&&(n&&e.d(1),r())}),e.o(t)}}function Q(e){e&&e.c()}function X(e,t,n,r){const{fragment:i,on_mount:o,on_destroy:l,after_update:u}=e.$$;i&&i.m(t,n),r||ye(()=>{const s=o.map(Re).filter(Ce);l?l.push(...s):K(s),e.$$.on_mount=[]}),u.forEach(ye)}function J(e,t){const n=e.$$;n.fragment!==null&&(K(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function vt(e,t){e.$$.dirty[0]===-1&&(re.push(e),dt(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function fe(e,t,n,r,i,o,l,u=[-1]){const s=we;ne(e);const a=e.$$={fragment:null,ctx:null,props:o,update:z,not_equal:i,bound:Pe(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(s?s.$$.context:[])),callbacks:Pe(),dirty:u,skip_bound:!1,root:t.target||s.$$.root};l&&l(a.root);let c=!1;if(a.ctx=n?n(e,t.props||{},(f,w,...x)=>{const T=x.length?x[0]:w;return a.ctx&&i(a.ctx[f],a.ctx[f]=T)&&(!a.skip_bound&&a.bound[f]&&a.bound[f](T),c&&vt(e,f)),w}):[],a.update(),c=!0,K(a.before_update),a.fragment=r?r(a.ctx):!1,t.target){if(t.hydrate){const f=ft(t.target);a.fragment&&a.fragment.l(f),f.forEach(A)}else a.fragment&&a.fragment.c();t.intro&&F(e.$$.fragment),X(e,t.target,t.anchor,t.customElement),Ie()}ne(s)}class he{$destroy(){J(this,1),this.$destroy=z}$on(t,n){const r=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return r.push(n),()=>{const i=r.indexOf(n);i!==-1&&r.splice(i,1)}}$set(t){this.$$set&&!st(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}function wt(e,t){t*=100;const n=[[101e4,t+215],[1009e3,t+215],[1007500,t+200],[1005e3,t+150],[1e6,t+100],[975e3,t],[925e3,t-300],[9e5,t-500],[8e5,(t-500)/2],[5e5,0]];let r=1;n.some((u,s)=>(r=s,e>u[0]));const i=n[r-1],o=n[r],l=o[1]+(i[1]-o[1])/(i[0]-o[0])*(e-o[0]);return Math.floor(l+Number.EPSILON)/100}function je(e){return e.slice(0,30).reduce((t,n)=>t+n)/30}function bt(e){return(je(e)*30+e[0]*10)/40}const U={ultima:"ULT",master:"MAS",expert:"EXP",advance:"ADV",basic:"BAS"};async function yt(e=U.master){const t=new FormData;t.append("genre","99"),t.append("token",Ee("_t"));const n={[U.ultima]:"sendUltima",[U.master]:"sendMaster",[U.expert]:"sendExpert",[U.advance]:"sendAdvance",[U.basic]:"sendBasic"},i=await(await fetch(`https://chunithm-net-eng.com/mobile/record/musicGenre/${n[e]}`,{headers:{"Cache-Control":"no-cache"},method:"POST",body:t})).text(),o=[...$(i).find("form")];return o.shift(),o}async function _t(){const e=[];for(const t of Object.values(U))e.push(await yt(t));return e.flatMap((t,n)=>t.map(r=>{var u,s;const i=$(r),o=i.find(".play_musicdata_icon");let l=null;if(o.length){for(const a of["fullchain","fullchain2","alljustice","fullcombo"])if(o.find(`img[src*="${a}"]`).length){l=a;break}}return{title:(u=i.find(".music_title"))==null?void 0:u.text(),score:ct((s=i.find(".text_b"))==null?void 0:s.text()),difficulty:Object.values(U)[n],clear:l}}).filter(r=>r.title!==null&&r.score>0))}async function St(){const e=await(await fetch("https://raw.githubusercontent.com/Dogeon188/chuni_new_intl_viewer/main/songData.json")).json(),t=await _t();return t.map(n=>{const r=e[n.title];if(r===void 0){alert(`[chuni-intl-viewer] Found unknown song "${n.title} ${n.difficulty}".
The data should be updating soon, please run chuni-viewer again later to get proper song data.`),fetch(new Request("https://chuniupdate.dogeon188.repl.co/sendUpdate",{method:"POST"})),n.const=0,n.rating=0;return}n.const=r[n.difficulty],n.rating=wt(n.score,n.const)}),t.sort((n,r)=>r.rating-n.rating||r.const-n.const),t}function $t(e){ce(e,"svelte-10sx98b","dt.svelte-10sx98b{color:#c9e;font-size:small}dd.svelte-10sx98b{margin-inline-start:1rem}")}function kt(e){let t,n,r,i,o,l;return{c(){t=p("div"),n=p("dt"),r=C(e[0]),i=_(),o=p("dd"),l=C(e[1]),v(n,"class","svelte-10sx98b"),v(o,"class","svelte-10sx98b")},m(u,s){M(u,t,s),d(t,n),d(n,r),d(t,i),d(t,o),d(o,l)},p(u,[s]){s&1&&D(r,u[0]),s&2&&D(l,u[1])},i:z,o:z,d(u){u&&A(t)}}}function xt(e,t,n){let{title:r}=t,{content:i}=t;return e.$$set=o=>{"title"in o&&n(0,r=o.title),"content"in o&&n(1,i=o.content)},[r,i]}class de extends he{constructor(t){super(),fe(this,t,xt,kt,oe,{title:0,content:1},$t)}}function Tt(e){ce(e,"svelte-1avyzqg","div.svelte-1avyzqg{border:#536 3px solid;border-radius:0.5rem;background-color:#324;width:fit-content;padding:0.5rem;margin:0.5rem;text-align:left}")}function Et(e){let t,n,r,i,o,l,u,s,a;return n=new de({props:{title:"Generated at",content:new Date().toLocaleDateString()}}),i=new de({props:{title:"Best 30 Avg.",content:e[0].toFixed(2)}}),l=new de({props:{title:"Max Achievable",content:e[1].toFixed(2)}}),s=new de({props:{title:"Total MAS Score",content:e[2].toString()}}),{c(){t=p("div"),Q(n.$$.fragment),r=_(),Q(i.$$.fragment),o=_(),Q(l.$$.fragment),u=_(),Q(s.$$.fragment),v(t,"class","svelte-1avyzqg")},m(c,f){M(c,t,f),X(n,t,null),d(t,r),X(i,t,null),d(t,o),X(l,t,null),d(t,u),X(s,t,null),a=!0},p(c,[f]){const w={};f&1&&(w.content=c[0].toFixed(2)),i.$set(w);const x={};f&2&&(x.content=c[1].toFixed(2)),l.$set(x);const T={};f&4&&(T.content=c[2].toString()),s.$set(T)},i(c){a||(F(n.$$.fragment,c),F(i.$$.fragment,c),F(l.$$.fragment,c),F(s.$$.fragment,c),a=!0)},o(c){B(n.$$.fragment,c),B(i.$$.fragment,c),B(l.$$.fragment,c),B(s.$$.fragment,c),a=!1},d(c){c&&A(t),J(n),J(i),J(l),J(s)}}}function Rt(e,t,n){let{b30:r}=t,{maxAchievable:i}=t,{totalMasterScore:o}=t;return e.$$set=l=>{"b30"in l&&n(0,r=l.b30),"maxAchievable"in l&&n(1,i=l.maxAchievable),"totalMasterScore"in l&&n(2,o=l.totalMasterScore)},[r,i,o]}class Pt extends he{constructor(t){super(),fe(this,t,Rt,Et,oe,{b30:0,maxAchievable:1,totalMasterScore:2},Tt)}}var De=globalThis&&globalThis.__awaiter||function(e,t,n,r){function i(o){return o instanceof n?o:new n(function(l){l(o)})}return new(n||(n=Promise))(function(o,l){function u(c){try{a(r.next(c))}catch(f){l(f)}}function s(c){try{a(r.throw(c))}catch(f){l(f)}}function a(c){c.done?o(c.value):i(c.value).then(u,s)}a((r=r.apply(e,t||[])).next())})};const Be="application/font-woff",Ue="image/jpeg",Ct={woff:Be,woff2:Be,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:Ue,jpeg:Ue,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml"};function Lt(e){const t=/\.([^./]*?)$/g.exec(e);return t?t[1]:""}function ge(e){const t=Lt(e).toLowerCase();return Ct[t]||""}function At(e,t){if(e.match(/^[a-z]+:\/\//i))return e;if(e.match(/^\/\//))return window.location.protocol+e;if(e.match(/^[a-z]+:/i))return e;const n=document.implementation.createHTMLDocument(),r=n.createElement("base"),i=n.createElement("a");return n.head.appendChild(r),n.body.appendChild(i),t&&(r.href=t),i.href=e,i.href}function Se(e){return e.search(/^(data:)/)!==-1}function me(e,t){return`data:${t};base64,${e}`}function Mt(e){return e.split(/,/)[1]}const Ot=function(){let t=0;const n=()=>`0000${(Math.random()*Math.pow(36,4)<<0).toString(36)}`.slice(-4);return()=>(t+=1,`u${n()}${t}`)}();function H(e){const t=[];for(let n=0,r=e.length;n<r;n+=1)t.push(e[n]);return t}function pe(e,t){const n=window.getComputedStyle(e).getPropertyValue(t);return parseFloat(n.replace("px",""))}function Ft(e){const t=pe(e,"border-left-width"),n=pe(e,"border-right-width");return e.clientWidth+t+n}function It(e){const t=pe(e,"border-top-width"),n=pe(e,"border-bottom-width");return e.clientHeight+t+n}function jt(){let e,t;try{t=process}catch{}const n=t&&t.env?t.env.devicePixelRatio:null;return n&&(e=parseInt(n,10),Number.isNaN(e)&&(e=1)),e||window.devicePixelRatio||1}function Dt(e){return e.toBlob?new Promise(t=>e.toBlob(t)):new Promise(t=>{const n=window.atob(e.toDataURL().split(",")[1]),r=n.length,i=new Uint8Array(r);for(let o=0;o<r;o+=1)i[o]=n.charCodeAt(o);t(new Blob([i],{type:"image/png"}))})}function $e(e){return new Promise((t,n)=>{const r=new Image;r.onload=()=>t(r),r.onerror=n,r.crossOrigin="anonymous",r.decoding="sync",r.src=e})}function Bt(e){return De(this,void 0,void 0,function*(){return Promise.resolve().then(()=>new XMLSerializer().serializeToString(e)).then(encodeURIComponent).then(t=>`data:image/svg+xml;charset=utf-8,${t}`)})}function Ut(e,t,n){return De(this,void 0,void 0,function*(){const r="http://www.w3.org/2000/svg",i=document.createElementNS(r,"svg"),o=document.createElementNS(r,"foreignObject");return i.setAttribute("width",`${t}`),i.setAttribute("height",`${n}`),i.setAttribute("viewBox",`0 0 ${t} ${n}`),o.setAttribute("width","100%"),o.setAttribute("height","100%"),o.setAttribute("x","0"),o.setAttribute("y","0"),o.setAttribute("externalResourcesRequired","true"),i.appendChild(o),o.appendChild(e),Bt(i)})}const ke={};function Ht(e){let t=e.replace(/\?.*/,"");return/ttf|otf|eot|woff2?/i.test(t)&&(t=t.replace(/.*\//,"")),t}function xe(e,t){const n=Ht(e);if(ke[n]!=null)return ke[n];t.cacheBust&&(e+=(/\?/.test(e)?"&":"?")+new Date().getTime());const r=o=>{let l="";if(t.imagePlaceholder){const s=t.imagePlaceholder.split(/,/);s&&s[1]&&(l=s[1])}let u=`Failed to fetch resource: ${e}`;return o&&(u=typeof o=="string"?o:o.message),u&&console.error(u),{blob:l,contentType:""}},i=window.fetch(e).then(o=>o.blob().then(l=>({blob:l,contentType:o.headers.get("Content-Type")||""}))).then(({blob:o,contentType:l})=>new Promise((u,s)=>{const a=new FileReader;a.onloadend=()=>u({contentType:l,blob:a.result}),a.onerror=s,a.readAsDataURL(o)})).then(({blob:o,contentType:l})=>({contentType:l,blob:Mt(o)})).catch(r);return ke[n]=i,i}function Vt(e){const t=e.getPropertyValue("content");return`${e.cssText} content: '${t.replace(/'|"/g,"")}';`}function Wt(e){return H(e).map(t=>{const n=e.getPropertyValue(t),r=e.getPropertyPriority(t);return`${t}: ${n}${r?" !important":""};`}).join(" ")}function qt(e,t,n){const r=`.${e}:${t}`,i=n.cssText?Vt(n):Wt(n);return document.createTextNode(`${r}{${i}}`)}function He(e,t,n){const r=window.getComputedStyle(e,n),i=r.getPropertyValue("content");if(i===""||i==="none")return;const o=Ot();try{t.className=`${t.className} ${o}`}catch{return}const l=document.createElement("style");l.appendChild(qt(o,n,r)),t.appendChild(l)}function zt(e,t){He(e,t,":before"),He(e,t,":after")}var Y=globalThis&&globalThis.__awaiter||function(e,t,n,r){function i(o){return o instanceof n?o:new n(function(l){l(o)})}return new(n||(n=Promise))(function(o,l){function u(c){try{a(r.next(c))}catch(f){l(f)}}function s(c){try{a(r.throw(c))}catch(f){l(f)}}function a(c){c.done?o(c.value):i(c.value).then(u,s)}a((r=r.apply(e,t||[])).next())})};function Gt(e){return Y(this,void 0,void 0,function*(){const t=e.toDataURL();return t==="data:,"?Promise.resolve(e.cloneNode(!1)):$e(t)})}function Xt(e,t){return Y(this,void 0,void 0,function*(){return Promise.resolve(e.poster).then(n=>xe(n,t)).then(n=>me(n.blob,ge(e.poster)||n.contentType)).then(n=>$e(n))})}function Jt(e,t){return Y(this,void 0,void 0,function*(){return e instanceof HTMLCanvasElement?Gt(e):e instanceof HTMLVideoElement&&e.poster?Xt(e,t):Promise.resolve(e.cloneNode(!1))})}const Kt=e=>e.tagName!=null&&e.tagName.toUpperCase()==="SLOT";function Qt(e,t,n){var r;return Y(this,void 0,void 0,function*(){const i=Kt(e)&&e.assignedNodes?H(e.assignedNodes()):H(((r=e.shadowRoot)!==null&&r!==void 0?r:e).childNodes);return i.length===0||e instanceof HTMLVideoElement?Promise.resolve(t):i.reduce((o,l)=>o.then(()=>Ve(l,n)).then(u=>{u&&t.appendChild(u)}),Promise.resolve()).then(()=>t)})}function Yt(e,t){const n=window.getComputedStyle(e),r=t.style;!r||(n.cssText?r.cssText=n.cssText:H(n).forEach(i=>{r.setProperty(i,n.getPropertyValue(i),n.getPropertyPriority(i))}))}function Zt(e,t){e instanceof HTMLTextAreaElement&&(t.innerHTML=e.value),e instanceof HTMLInputElement&&t.setAttribute("value",e.value)}function Nt(e,t){return Y(this,void 0,void 0,function*(){return t instanceof Element?Promise.resolve().then(()=>Yt(e,t)).then(()=>zt(e,t)).then(()=>Zt(e,t)).then(()=>t):Promise.resolve(t)})}function Ve(e,t,n){return Y(this,void 0,void 0,function*(){return!n&&t.filter&&!t.filter(e)?Promise.resolve(null):Promise.resolve(e).then(r=>Jt(r,t)).then(r=>Qt(e,r,t)).then(r=>Nt(e,r))})}var en=globalThis&&globalThis.__awaiter||function(e,t,n,r){function i(o){return o instanceof n?o:new n(function(l){l(o)})}return new(n||(n=Promise))(function(o,l){function u(c){try{a(r.next(c))}catch(f){l(f)}}function s(c){try{a(r.throw(c))}catch(f){l(f)}}function a(c){c.done?o(c.value):i(c.value).then(u,s)}a((r=r.apply(e,t||[])).next())})};const We=/url\((['"]?)([^'"]+?)\1\)/g,tn=/url\([^)]+\)\s*format\((["'])([^"']+)\1\)/g,nn=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function rn(e){const t=e.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1");return new RegExp(`(url\\(['"]?)(${t})(['"]?\\))`,"g")}function on(e){const t=[];return e.replace(We,(n,r,i)=>(t.push(i),n)),t.filter(n=>!Se(n))}function ln(e,t,n,r,i){const o=n?At(t,n):t;return Promise.resolve(o).then(l=>i?i(l):xe(l,r)).then(l=>typeof l=="string"?me(l,ge(t)):me(l.blob,ge(t)||l.contentType)).then(l=>e.replace(rn(t),`$1${l}$3`)).then(l=>l,()=>o)}function cn(e,{preferredFontFormat:t}){return t?e.replace(nn,n=>{for(;;){const[r,,i]=tn.exec(n)||[];if(!i)return"";if(i===t)return`src: ${r};`}}):e}function qe(e){return e.search(We)!==-1}function ze(e,t,n){return en(this,void 0,void 0,function*(){if(!qe(e))return Promise.resolve(e);const r=cn(e,n);return Promise.resolve(r).then(on).then(i=>i.reduce((o,l)=>o.then(u=>ln(u,l,t,n)),Promise.resolve(r)))})}var ve=globalThis&&globalThis.__awaiter||function(e,t,n,r){function i(o){return o instanceof n?o:new n(function(l){l(o)})}return new(n||(n=Promise))(function(o,l){function u(c){try{a(r.next(c))}catch(f){l(f)}}function s(c){try{a(r.throw(c))}catch(f){l(f)}}function a(c){c.done?o(c.value):i(c.value).then(u,s)}a((r=r.apply(e,t||[])).next())})};function sn(e,t){var n;return ve(this,void 0,void 0,function*(){const r=(n=e.style)===null||n===void 0?void 0:n.getPropertyValue("background");return r?Promise.resolve(r).then(i=>ze(i,null,t)).then(i=>(e.style.setProperty("background",i,e.style.getPropertyPriority("background")),e)):Promise.resolve(e)})}function un(e,t){return ve(this,void 0,void 0,function*(){if(!(e instanceof HTMLImageElement&&!Se(e.src))&&!(e instanceof SVGImageElement&&!Se(e.href.baseVal)))return Promise.resolve(e);const n=e instanceof HTMLImageElement?e.src:e.href.baseVal;return Promise.resolve(n).then(r=>xe(r,t)).then(r=>me(r.blob,ge(n)||r.contentType)).then(r=>new Promise((i,o)=>{e.onload=i,e.onerror=o,e instanceof HTMLImageElement?(e.srcset="",e.src=r):e.href.baseVal=r})).then(()=>e,()=>e)})}function an(e,t){return ve(this,void 0,void 0,function*(){const r=H(e.childNodes).map(i=>Ge(i,t));return Promise.all(r).then(()=>e)})}function Ge(e,t){return ve(this,void 0,void 0,function*(){return e instanceof Element?Promise.resolve(e).then(n=>sn(n,t)).then(n=>un(n,t)).then(n=>an(n,t)):Promise.resolve(e)})}function fn(e,t){const{style:n}=e;t.backgroundColor&&(n.backgroundColor=t.backgroundColor),t.width&&(n.width=`${t.width}px`),t.height&&(n.height=`${t.height}px`);const r=t.style;return r!=null&&Object.keys(r).forEach(i=>{n[i]=r[i]}),e}var ie=globalThis&&globalThis.__awaiter||function(e,t,n,r){function i(o){return o instanceof n?o:new n(function(l){l(o)})}return new(n||(n=Promise))(function(o,l){function u(c){try{a(r.next(c))}catch(f){l(f)}}function s(c){try{a(r.throw(c))}catch(f){l(f)}}function a(c){c.done?o(c.value):i(c.value).then(u,s)}a((r=r.apply(e,t||[])).next())})};const Xe={};function Je(e){const t=Xe[e];if(t!=null)return t;const n=window.fetch(e).then(r=>({url:e,cssText:r.text()}));return Xe[e]=n,n}function Ke(e){return ie(this,void 0,void 0,function*(){return e.cssText.then(t=>{let n=t;const r=/url\(["']?([^"')]+)["']?\)/g,o=(n.match(/url\([^)]+\)/g)||[]).map(l=>{let u=l.replace(r,"$1");return u.startsWith("https://")||(u=new URL(u,e.url).href),window.fetch(u).then(s=>s.blob()).then(s=>new Promise((a,c)=>{const f=new FileReader;f.onloadend=()=>{n=n.replace(l,`url(${f.result})`),a([l,f.result])},f.onerror=c,f.readAsDataURL(s)}))});return Promise.all(o).then(()=>n)})})}function Qe(e){if(e==null)return[];const t=[],n=/(\/\*[\s\S]*?\*\/)/gi;let r=e.replace(n,"");const i=new RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");for(;;){const s=i.exec(r);if(s===null)break;t.push(s[0])}r=r.replace(i,"");const o=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,l="((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})",u=new RegExp(l,"gi");for(;;){let s=o.exec(r);if(s===null){if(s=u.exec(r),s===null)break;o.lastIndex=u.lastIndex}else u.lastIndex=o.lastIndex;t.push(s[0])}return t}function hn(e){return ie(this,void 0,void 0,function*(){const t=[],n=[];return e.forEach(r=>{if("cssRules"in r)try{H(r.cssRules).forEach((i,o)=>{if(i.type===CSSRule.IMPORT_RULE){let l=o+1;const u=i.href,s=Je(u).then(a=>a?Ke(a):"").then(a=>Qe(a).forEach(c=>{try{r.insertRule(c,c.startsWith("@import")?l+=1:r.cssRules.length)}catch(f){console.error("Error inserting rule from remote css",{rule:c,error:f})}})).catch(a=>{console.error("Error loading remote css",a.toString())});n.push(s)}})}catch(i){const o=e.find(l=>l.href==null)||document.styleSheets[0];r.href!=null&&n.push(Je(r.href).then(l=>l?Ke(l):"").then(l=>Qe(l).forEach(u=>{o.insertRule(u,r.cssRules.length)})).catch(l=>{console.error("Error loading remote stylesheet",l.toString())})),console.error("Error inlining remote css file",i.toString())}}),Promise.all(n).then(()=>(e.forEach(r=>{if("cssRules"in r)try{H(r.cssRules).forEach(i=>{t.push(i)})}catch(i){console.error(`Error while reading CSS rules from ${r.href}`,i.toString())}}),t))})}function dn(e){return e.filter(t=>t.type===CSSRule.FONT_FACE_RULE).filter(t=>qe(t.style.getPropertyValue("src")))}function gn(e){return ie(this,void 0,void 0,function*(){return new Promise((t,n)=>{e.ownerDocument==null&&n(new Error("Provided element is not within a Document")),t(H(e.ownerDocument.styleSheets))}).then(t=>hn(t)).then(dn)})}function mn(e,t){return ie(this,void 0,void 0,function*(){return gn(e).then(n=>Promise.all(n.map(r=>{const i=r.parentStyleSheet?r.parentStyleSheet.href:null;return ze(r.cssText,i,t)}))).then(n=>n.join(`
`))})}function pn(e,t){return ie(this,void 0,void 0,function*(){return(t.fontEmbedCSS!=null?Promise.resolve(t.fontEmbedCSS):mn(e,t)).then(n=>{const r=document.createElement("style"),i=document.createTextNode(n);return r.appendChild(i),e.firstChild?e.insertBefore(r,e.firstChild):e.appendChild(r),e})})}var Te=globalThis&&globalThis.__awaiter||function(e,t,n,r){function i(o){return o instanceof n?o:new n(function(l){l(o)})}return new(n||(n=Promise))(function(o,l){function u(c){try{a(r.next(c))}catch(f){l(f)}}function s(c){try{a(r.throw(c))}catch(f){l(f)}}function a(c){c.done?o(c.value):i(c.value).then(u,s)}a((r=r.apply(e,t||[])).next())})};function Ye(e,t={}){const n=t.width||Ft(e),r=t.height||It(e);return{width:n,height:r}}function vn(e,t={}){return Te(this,void 0,void 0,function*(){const{width:n,height:r}=Ye(e,t);return Promise.resolve(e).then(i=>Ve(i,t,!0)).then(i=>pn(i,t)).then(i=>Ge(i,t)).then(i=>fn(i,t)).then(i=>Ut(i,n,r))})}const R=16384;function wn(e){(e.width>R||e.height>R)&&(e.width>R&&e.height>R?e.width>e.height?(e.height*=R/e.width,e.width=R):(e.width*=R/e.height,e.height=R):e.width>R?(e.height*=R/e.width,e.width=R):(e.width*=R/e.height,e.height=R))}function bn(e,t={}){return Te(this,void 0,void 0,function*(){return vn(e,t).then($e).then(n=>{const r=document.createElement("canvas"),i=r.getContext("2d"),o=t.pixelRatio||jt(),{width:l,height:u}=Ye(e,t),s=t.canvasWidth||l,a=t.canvasHeight||u;return r.width=s*o,r.height=a*o,t.skipAutoScale||wn(r),r.style.width=`${s}`,r.style.height=`${a}`,t.backgroundColor&&(i.fillStyle=t.backgroundColor,i.fillRect(0,0,r.width,r.height)),i.drawImage(n,0,0,r.width,r.height),r})})}function yn(e,t={}){return Te(this,void 0,void 0,function*(){return bn(e,t).then(Dt)})}async function _n(e){var r,i;const t=(r=document.body.shadowRoot)==null?void 0:r.querySelector("main");let n=t==null?void 0:t.cloneNode(!0);(i=t==null?void 0:t.parentElement)==null||i.appendChild(n),n.querySelectorAll("tr").forEach((o,l)=>{l>(e=="b30"?30:40)&&o.remove()}),yn(n,{backgroundColor:"#223"}).then(async o=>{if(n.remove(),o==null)return alert("[chuni-intl-viewer] Something went wrong when converting your scores to PNG. Please ask the author to fix it.");if(lt()){const l=new File([o],`result_${e}.png`,{type:o.type});navigator!=null&&navigator.canShare({files:[l]})&&navigator.share({files:[l],text:"#CHUNITHM"}).catch(console.log)}else $("<a>").attr({download:`result_${e}.png`,href:window.URL.createObjectURL(o)})[0].click()})}async function Ze(e,t){$(e.currentTarget).fadeTo(100,.5),await _n(t),$(e.currentTarget).fadeTo(100,1)}function Sn(e){ce(e,"svelte-1yiog27",'@charset "UTF-8";button.svelte-1yiog27.svelte-1yiog27{margin:0.5rem;padding:0.3rem;font-family:inherit;font-weight:bold;background-color:#324;border:#536 3px solid;color:#eec;border-radius:0.3rem;cursor:pointer}button.filter.svelte-1yiog27.svelte-1yiog27{border-color:#48c;background-color:#159;width:6rem}button.sort.svelte-1yiog27.svelte-1yiog27{border-color:#48c;background-color:#159}button.dl.svelte-1yiog27 i.svelte-1yiog27{background-image:url(https://raw.githubusercontent.com/Dogeon188/chuni_new_intl_viewer/main/assets/dl.png);display:inline-block;width:1rem;height:1rem;background-position:0px 0px;background-size:cover}table.svelte-1yiog27.svelte-1yiog27{border-spacing:0;width:100%}td.svelte-1yiog27.svelte-1yiog27,th.svelte-1yiog27.svelte-1yiog27{padding:0.5rem}th.current-sort.svelte-1yiog27.svelte-1yiog27:before{content:"\u25BC"}tbody.svelte-1yiog27 tr:nth-child(-n+30) td.svelte-1yiog27:first-child{color:#fc4}tbody.svelte-1yiog27 tr:nth-child(-n+40) td.svelte-1yiog27:first-child{font-weight:bold}tbody.svelte-1yiog27 tr.svelte-1yiog27:nth-child(odd){background-color:#324}tbody.svelte-1yiog27 tr td.svelte-1yiog27:nth-child(2){overflow:hidden;text-overflow:ellipsis;font-weight:bold}tbody.svelte-1yiog27 tr td:nth-child(2).diff-ult.svelte-1yiog27{color:#3cf}tbody.svelte-1yiog27 tr td:nth-child(2).diff-mas.svelte-1yiog27{color:#e9f}tbody.svelte-1yiog27 tr td:nth-child(2).diff-exp.svelte-1yiog27{color:#e46}tbody.svelte-1yiog27 tr td:nth-child(2).diff-adv.svelte-1yiog27{color:#e73}tbody.svelte-1yiog27 tr td:nth-child(2).diff-bas.svelte-1yiog27{color:#1c3}')}function Ne(e,t,n){const r=e.slice();return r[13]=t[n],r[15]=n,r}function et(e,t,n){const r=e.slice();return r[16]=t[n],r}function tt(e){let t,n,r,i,o;function l(){return e[12](e[16])}return{c(){t=p("th"),n=C(e[16]),v(t,"class",r=Ae(e[16]==Object.keys(e[3])[e[1]]?"current-sort":"")+" svelte-1yiog27")},m(u,s){M(u,t,s),d(t,n),i||(o=te(t,"click",function(){Ce(Object.keys(e[3]).indexOf(e[16])>=0?l:null)&&(Object.keys(e[3]).indexOf(e[16])>=0?l:null).apply(this,arguments)}),i=!0)},p(u,s){e=u,s&2&&r!==(r=Ae(e[16]==Object.keys(e[3])[e[1]]?"current-sort":"")+" svelte-1yiog27")&&v(t,"class",r)},d(u){u&&A(t),i=!1,o()}}}function nt(e){let t,n,r;return{c(){t=p("img"),Le(t.src,n="https://chunithm-net-eng.com/mobile/images/icon_"+e[13].clear+".png")||v(t,"src",n),v(t,"alt",r=e[13].clear)},m(i,o){M(i,t,o)},p(i,o){o&4&&!Le(t.src,n="https://chunithm-net-eng.com/mobile/images/icon_"+i[13].clear+".png")&&v(t,"src",n),o&4&&r!==(r=i[13].clear)&&v(t,"alt",r)},d(i){i&&A(t)}}}function rt(e){var ee,P,j,k;let t,n,r=e[15]+1+"",i,o,l,u=e[13].title+"",s,a,c,f,w=((P=(ee=e[13].const)==null?void 0:ee.toFixed(1))!=null?P:"??.?")+"",x,T,E,g=e[13].score+"",y,O,V,I=((k=(j=e[13].rating)==null?void 0:j.toFixed(2))!=null?k:"??.??")+"",Z,W,L,N,S=e[13].clear!==null&&nt(e);return{c(){t=p("tr"),n=p("td"),i=C(r),o=_(),l=p("td"),s=C(u),c=_(),f=p("td"),x=C(w),T=_(),E=p("td"),y=C(g),O=_(),V=p("td"),Z=C(I),W=_(),L=p("td"),S&&S.c(),N=_(),v(n,"class","svelte-1yiog27"),v(l,"class",a="diff-"+e[13].difficulty.toLowerCase()+" svelte-1yiog27"),v(f,"class","svelte-1yiog27"),v(E,"class","svelte-1yiog27"),v(V,"class","svelte-1yiog27"),v(L,"class","svelte-1yiog27"),v(t,"class","svelte-1yiog27")},m(h,b){M(h,t,b),d(t,n),d(n,i),d(t,o),d(t,l),d(l,s),d(t,c),d(t,f),d(f,x),d(t,T),d(t,E),d(E,y),d(t,O),d(t,V),d(V,Z),d(t,W),d(t,L),S&&S.m(L,null),d(t,N)},p(h,b){var m,q,it,ot;b&4&&u!==(u=h[13].title+"")&&D(s,u),b&4&&a!==(a="diff-"+h[13].difficulty.toLowerCase()+" svelte-1yiog27")&&v(l,"class",a),b&4&&w!==(w=((q=(m=h[13].const)==null?void 0:m.toFixed(1))!=null?q:"??.?")+"")&&D(x,w),b&4&&g!==(g=h[13].score+"")&&D(y,g),b&4&&I!==(I=((ot=(it=h[13].rating)==null?void 0:it.toFixed(2))!=null?ot:"??.??")+"")&&D(Z,I),h[13].clear!==null?S?S.p(h,b):(S=nt(h),S.c(),S.m(L,null)):S&&(S.d(1),S=null)},d(h){h&&A(t),S&&S.d()}}}function $n(e){let t,n,r=e[0]?"Show All":"Show B40",i,o,l,u,s,a,c,f,w=Object.keys(e[3])[e[1]]+"",x,T,E,g,y,O,V,I,Z,W,L,N,S;g=new Pt({props:{b30:je(e[4]),maxAchievable:bt(e[4]),totalMasterScore:e[5]}});let ee=["#","Title","Const.","Score","Rating","FC/AJ"],P=[];for(let h=0;h<6;h+=1)P[h]=tt(et(e,ee,h));let j=e[2],k=[];for(let h=0;h<j.length;h+=1)k[h]=rt(Ne(e,j,h));return{c(){t=p("div"),n=p("button"),i=C(r),o=_(),l=p("button"),l.innerHTML='<i class="svelte-1yiog27"></i>Best 30',u=_(),s=p("button"),s.innerHTML='<i class="svelte-1yiog27"></i>Best 40',a=_(),c=p("button"),f=C("Sort: "),x=C(w),T=_(),E=p("main"),Q(g.$$.fragment),y=_(),O=p("table"),V=p("thead"),I=p("tr");for(let h=0;h<6;h+=1)P[h].c();Z=_(),W=p("tbody");for(let h=0;h<k.length;h+=1)k[h].c();v(n,"class","filter svelte-1yiog27"),v(l,"class","dl svelte-1yiog27"),v(s,"class","dl svelte-1yiog27"),v(c,"class","sort svelte-1yiog27"),v(t,"class","buttons"),v(W,"class","svelte-1yiog27"),v(O,"id","chuni-result-table"),v(O,"class","svelte-1yiog27"),v(E,"id","chuni-viewer-main")},m(h,b){M(h,t,b),d(t,n),d(n,i),d(t,o),d(t,l),d(t,u),d(t,s),d(t,a),d(t,c),d(c,f),d(c,x),M(h,T,b),M(h,E,b),X(g,E,null),d(E,y),d(E,O),d(O,V),d(V,I);for(let m=0;m<6;m+=1)P[m].m(I,null);d(O,Z),d(O,W);for(let m=0;m<k.length;m+=1)k[m].m(W,null);L=!0,N||(S=[te(n,"click",e[8]),te(l,"click",e[9]),te(s,"click",e[10]),te(c,"click",e[11])],N=!0)},p(h,[b]){if((!L||b&1)&&r!==(r=h[0]?"Show All":"Show B40")&&D(i,r),(!L||b&2)&&w!==(w=Object.keys(h[3])[h[1]]+"")&&D(x,w),b&10){ee=["#","Title","Const.","Score","Rating","FC/AJ"];let m;for(m=0;m<6;m+=1){const q=et(h,ee,m);P[m]?P[m].p(q,b):(P[m]=tt(q),P[m].c(),P[m].m(I,null))}for(;m<6;m+=1)P[m].d(1)}if(b&4){j=h[2];let m;for(m=0;m<j.length;m+=1){const q=Ne(h,j,m);k[m]?k[m].p(q,b):(k[m]=rt(q),k[m].c(),k[m].m(W,null))}for(;m<k.length;m+=1)k[m].d(1);k.length=j.length}},i(h){L||(F(g.$$.fragment,h),L=!0)},o(h){B(g.$$.fragment,h),L=!1},d(h){h&&A(t),h&&A(T),h&&A(E),J(g),Me(P,h),Me(k,h),N=!1,K(S)}}}function kn(e,t,n){let r,i,{recordList:o}=t,l=!1,u=0;const s={Rating:(g,y)=>y.rating-g.rating||y.const-g.const,Score:(g,y)=>y.score-g.score,"Const.":(g,y)=>y.const-g.const,Title:(g,y)=>g.title<y.title?-1:g.title>y.title?1:0},a=o.map(g=>g.rating),c=o.filter(g=>g.difficulty==="MAS").map(g=>g.score).reduce((g,y)=>g+y),f=()=>{n(0,l=!l),l&&n(1,u=0)},w=g=>Ze(g,"b30"),x=g=>Ze(g,"b40"),T=()=>{n(1,u++,u),n(1,u%=Object.keys(s).length)},E=g=>{n(1,u=Object.keys(s).indexOf(g))};return e.$$set=g=>{"recordList"in g&&n(6,o=g.recordList)},e.$$.update=()=>{e.$$.dirty&66&&n(7,r=o.sort(Object.values(s)[u])),e.$$.dirty&129&&n(2,i=l?r.slice(0,40):r)},[l,u,i,s,a,c,o,r,f,w,x,T,E]}class xn extends he{constructor(t){super(),fe(this,t,kn,$n,oe,{recordList:6},Sn)}}function Tn(e){ce(e,"svelte-orwgka","body.svelte-orwgka.svelte-orwgka{padding-top:1rem;background-color:#223;color:#eec;margin:0;min-height:100%;min-width:600px;width:100%}body.svelte-orwgka a.svelte-orwgka{color:#3cc;text-decoration:none}")}function En(e){let t,n;return t=new xn({props:{recordList:e[1]}}),{c(){Q(t.$$.fragment)},m(r,i){X(t,r,i),n=!0},p(r,i){const o={};i&2&&(o.recordList=r[1]),t.$set(o)},i(r){n||(F(t.$$.fragment,r),n=!0)},o(r){B(t.$$.fragment,r),n=!1},d(r){J(t,r)}}}function Rn(e){let t;return{c(){t=p("div"),t.innerHTML="<p>Loading...</p>"},m(n,r){M(n,t,r)},p:z,i:z,o:z,d(n){n&&A(t)}}}function Pn(e){let t,n,r,i,o,l;const u=[Rn,En],s=[];function a(c,f){return c[0]?1:0}return i=a(e),o=s[i]=u[i](e),{c(){t=p("body"),n=p("div"),n.innerHTML=`<h3>Chunithm International Score Viewer</h3> 
        <a href="https://github.com/Dogeon188/chuni_new_intl_viewer" target="_blank" rel="noopener noreferrer" class="svelte-orwgka">Dogeon188/chuni_new_intl_viewer@GitHub</a>`,r=_(),o.c(),v(t,"class","svelte-orwgka")},m(c,f){M(c,t,f),d(t,n),d(t,r),s[i].m(t,null),l=!0},p(c,[f]){let w=i;i=a(c),i===w?s[i].p(c,f):(mt(),B(s[w],1,1,()=>{s[w]=null}),pt(),o=s[i],o?o.p(c,f):(o=s[i]=u[i](c),o.c()),F(o,1),o.m(t,null))},i(c){l||(F(o),l=!0)},o(c){B(o),l=!1},d(c){c&&A(t),s[i].d()}}}function Cn(e,t,n){let r=!1,i=[];return(async()=>(n(1,i=await St()),n(0,r=!0)))(),[r,i]}class Ln extends he{constructor(t){super(),fe(this,t,Cn,Pn,oe,{},Tn)}}async function An(){if(window.chuniIntlViewer){alert("[chuni-intl-viewer] Please refresh the page before another new fetch.");return}if(window.chuniIntlViewer=!0,window.location.hostname!=="chunithm-net-eng.com"){alert("[chuni_intl_viewer] This tools could only be used under chunithm-net international."),window.location.href="https://chunithm-net-eng.com/";return}if(!Ee("_t")){alert("[chuni-intl-viewer] Token not found. Please login first."),window.location.href="https://chunithm-net-eng.com/";return}const e=document.body.attachShadow({mode:"open"});new Ln({target:e})}An()})();
