(function(){"use strict";function Fe(e){const t=document.cookie.split(";").map(n=>decodeURIComponent(n.trim())).map(n=>n.split("=")).find(n=>n[0]===e);return t?t[1]:""}function De(){return/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)}function at(e){return Number([...e].filter(t=>t!==",").join(""))}function I(){}function Ie(e){return e()}function Me(){return Object.create(null)}function Z(e){e.forEach(Ie)}function ft(e){return typeof e=="function"}function oe(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function ht(e){return Object.keys(e).length===0}function dt(e,...t){if(e==null)return I;const n=e.subscribe(...t);return n.unsubscribe?()=>n.unsubscribe():n}function mt(e,t,n){e.$$.on_destroy.push(dt(t,n))}function h(e,t){e.appendChild(t)}function me(e,t,n){const r=gt(e);if(!r.getElementById(t)){const i=b("style");i.id=t,i.textContent=n,pt(r,i)}}function gt(e){if(!e)return document;const t=e.getRootNode?e.getRootNode():e.ownerDocument;return t&&t.host?t:e.ownerDocument}function pt(e,t){h(e.head||e,t)}function M(e,t,n){e.insertBefore(t,n||null)}function L(e){e.parentNode.removeChild(e)}function Be(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function b(e){return document.createElement(e)}function x(e){return document.createTextNode(e)}function y(){return x(" ")}function se(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function v(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function bt(e){return Array.from(e.childNodes)}function A(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}function N(e,t,n){e.classList[n?"add":"remove"](t)}let xe;function le(e){xe=e}const ce=[],Ue=[],ge=[],Ve=[],vt=Promise.resolve();let ke=!1;function wt(){ke||(ke=!0,vt.then(He))}function Ee(e){ge.push(e)}const Te=new Set;let pe=0;function He(){const e=xe;do{for(;pe<ce.length;){const t=ce[pe];pe++,le(t),_t(t.$$)}for(le(null),ce.length=0,pe=0;Ue.length;)Ue.pop()();for(let t=0;t<ge.length;t+=1){const n=ge[t];Te.has(n)||(Te.add(n),n())}ge.length=0}while(ce.length);for(;Ve.length;)Ve.pop()();ke=!1,Te.clear(),le(e)}function _t(e){if(e.fragment!==null){e.update(),Z(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(Ee)}}const be=new Set;let K;function yt(){K={r:0,c:[],p:K}}function St(){K.r||Z(K.c),K=K.p}function W(e,t){e&&e.i&&(be.delete(e),e.i(t))}function Q(e,t,n,r){if(e&&e.o){if(be.has(e))return;be.add(e),K.c.push(()=>{be.delete(e),r&&(n&&e.d(1),r())}),e.o(t)}}function ue(e){e&&e.c()}function ee(e,t,n,r){const{fragment:i,on_mount:o,on_destroy:s,after_update:l}=e.$$;i&&i.m(t,n),r||Ee(()=>{const c=o.map(Ie).filter(ft);s?s.push(...c):Z(c),e.$$.on_mount=[]}),l.forEach(Ee)}function te(e,t){const n=e.$$;n.fragment!==null&&(Z(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function jt(e,t){e.$$.dirty[0]===-1&&(ce.push(e),wt(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function ve(e,t,n,r,i,o,s,l=[-1]){const c=xe;le(e);const u=e.$$={fragment:null,ctx:null,props:o,update:I,not_equal:i,bound:Me(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(c?c.$$.context:[])),callbacks:Me(),dirty:l,skip_bound:!1,root:t.target||c.$$.root};s&&s(u.root);let a=!1;if(u.ctx=n?n(e,t.props||{},(f,S,...O)=>{const C=O.length?O[0]:S;return u.ctx&&i(u.ctx[f],u.ctx[f]=C)&&(!u.skip_bound&&u.bound[f]&&u.bound[f](C),a&&jt(e,f)),S}):[],u.update(),a=!0,Z(u.before_update),u.fragment=r?r(u.ctx):!1,t.target){if(t.hydrate){const f=bt(t.target);u.fragment&&u.fragment.l(f),f.forEach(L)}else u.fragment&&u.fragment.c();t.intro&&W(e.$$.fragment),ee(e,t.target,t.anchor,t.customElement),He()}le(c)}class we{$destroy(){te(this,1),this.$destroy=I}$on(t,n){const r=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return r.push(n),()=>{const i=r.indexOf(n);i!==-1&&r.splice(i,1)}}$set(t){this.$$set&&!ht(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}function $t(e,t){t*=100;const n=[[101e4,t+215],[1009e3,t+215],[1007500,t+200],[1005e3,t+150],[1e6,t+100],[975e3,t],[925e3,t-300],[9e5,t-500],[8e5,(t-500)/2],[5e5,0]];let r=1;n.some((l,c)=>(r=c,e>l[0]));const i=n[r-1],o=n[r],s=o[1]+(i[1]-o[1])/(i[0]-o[0])*(e-o[0]);return Math.floor(s+Number.EPSILON)/100}function We(e){return e.slice(0,30).reduce((t,n)=>t+n)/30}function xt(e){return(We(e)*30+e[0]*10)/40}const ne=[];function kt(e,t=I){let n;const r=new Set;function i(l){if(oe(e,l)&&(e=l,n)){const c=!ne.length;for(const u of r)u[1](),ne.push(u,e);if(c){for(let u=0;u<ne.length;u+=2)ne[u][0](ne[u+1]);ne.length=0}}}function o(l){i(l(e))}function s(l,c=I){const u=[l,c];return r.add(u),r.size===1&&(n=t(i)||I),l(e),()=>{r.delete(u),r.size===0&&(n(),n=null)}}return{set:i,update:o,subscribe:s}}const _e=kt(""),q={ultima:"ULT",master:"MAS",expert:"EXP",advanced:"ADV",basic:"BAS"};async function Et(e=q.master){const t=new FormData;t.append("genre","99"),t.append("token",Fe("_t"));const n={[q.ultima]:"sendUltima",[q.master]:"sendMaster",[q.expert]:"sendExpert",[q.advanced]:"sendAdvanced",[q.basic]:"sendBasic"},r=await fetch(`https://chunithm-net-eng.com/mobile/record/musicGenre/${n[e]}`,{headers:{"Cache-Control":"no-cache"},method:"POST",body:t}),i=[...$(await r.text()).find("form")];return i.shift(),i}async function Tt(){const e=[];for(const t of Object.values(q))_e.set(`Fetching ${t} record...`),e.push(await Et(t));return e.flatMap((t,n)=>t.map(r=>{var l,c;const i=$(r),o=i.find(".play_musicdata_icon");let s=null;return o.length&&(o.find('img[src*="alljustice"]').length?s="AJ":o.find('img[src*="fullcombo"]').length&&(s="FC")),{title:(l=i.find(".music_title"))==null?void 0:l.text(),score:at((c=i.find(".text_b"))==null?void 0:c.text()),difficulty:Object.values(q)[n],clear:s}}).filter(r=>r.title!==null&&r.score>0))}async function Rt(){_e.set("Fetching song data...");const e=await(await fetch("https://raw.githubusercontent.com/Dogeon188/chuni_new_intl_viewer/main/songData.json")).json(),t=await Tt();return _e.set("Calculating data..."),t.map(n=>{const r=e[n.title];if(r===void 0){alert(`[chuni-intl-viewer] Found unknown song "${n.title} ${n.difficulty}".
The data should be updating soon, please run chuni-viewer again later to get proper song data.`),fetch(new Request("https://chuniupdate.dogeon188.repl.co/sendUpdate",{method:"POST"})),n.const=0,n.rating=0;return}n.const=r[n.difficulty],n.rating=$t(n.score,n.const)}),t.sort((n,r)=>r.rating-n.rating||r.const-n.const),t.map((n,r)=>{n.rank=r+1}),t}function Ct(e){me(e,"svelte-dndlcq","dt.svelte-dndlcq{color:#c9e;font-size:small}dd.svelte-dndlcq{margin-inline-start:0}")}function Pt(e){let t,n,r,i,o,s;return{c(){t=b("div"),n=b("dt"),r=x(e[0]),i=y(),o=b("dd"),s=x(e[1]),v(n,"class","svelte-dndlcq"),v(o,"class","svelte-dndlcq")},m(l,c){M(l,t,c),h(t,n),h(n,r),h(t,i),h(t,o),h(o,s)},p(l,[c]){c&1&&A(r,l[0]),c&2&&A(s,l[1])},i:I,o:I,d(l){l&&L(t)}}}function Lt(e,t,n){let{title:r}=t,{content:i}=t;return e.$$set=o=>{"title"in o&&n(0,r=o.title),"content"in o&&n(1,i=o.content)},[r,i]}class Re extends we{constructor(t){super(),ve(this,t,Lt,Pt,oe,{title:0,content:1},Ct)}}function At(e){me(e,"svelte-1updny8","div.svelte-1updny8{border:#436 3px solid;border-radius:0.5rem;background-color:#224;width:fit-content;padding:0.5rem;margin:0.5rem;text-align:center;display:flex;justify-content:space-around;width:calc(100% - 2rem - 6px)}")}function Ot(e){let t,n,r,i,o,s,l;return n=new Re({props:{title:"Generated at",content:new Date().toLocaleDateString()}}),i=new Re({props:{title:"B30 Avg.",content:e[0].toFixed(2)}}),s=new Re({props:{title:"Max Achievable",content:e[1].toFixed(2)}}),{c(){t=b("div"),ue(n.$$.fragment),r=y(),ue(i.$$.fragment),o=y(),ue(s.$$.fragment),v(t,"class","svelte-1updny8")},m(c,u){M(c,t,u),ee(n,t,null),h(t,r),ee(i,t,null),h(t,o),ee(s,t,null),l=!0},p(c,[u]){const a={};u&1&&(a.content=c[0].toFixed(2)),i.$set(a);const f={};u&2&&(f.content=c[1].toFixed(2)),s.$set(f)},i(c){l||(W(n.$$.fragment,c),W(i.$$.fragment,c),W(s.$$.fragment,c),l=!0)},o(c){Q(n.$$.fragment,c),Q(i.$$.fragment,c),Q(s.$$.fragment,c),l=!1},d(c){c&&L(t),te(n),te(i),te(s)}}}function Ft(e,t,n){let{b30:r}=t,{maxAchievable:i}=t;return e.$$set=o=>{"b30"in o&&n(0,r=o.b30),"maxAchievable"in o&&n(1,i=o.maxAchievable)},[r,i]}class Dt extends we{constructor(t){super(),ve(this,t,Ft,Ot,oe,{b30:0,maxAchievable:1},At)}}var qe=globalThis&&globalThis.__awaiter||function(e,t,n,r){function i(o){return o instanceof n?o:new n(function(s){s(o)})}return new(n||(n=Promise))(function(o,s){function l(a){try{u(r.next(a))}catch(f){s(f)}}function c(a){try{u(r.throw(a))}catch(f){s(f)}}function u(a){a.done?o(a.value):i(a.value).then(l,c)}u((r=r.apply(e,t||[])).next())})};const ze="application/font-woff",Ge="image/jpeg",It={woff:ze,woff2:ze,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:Ge,jpeg:Ge,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml"};function Mt(e){const t=/\.([^./]*?)$/g.exec(e);return t?t[1]:""}function ye(e){const t=Mt(e).toLowerCase();return It[t]||""}function Bt(e,t){if(e.match(/^[a-z]+:\/\//i))return e;if(e.match(/^\/\//))return window.location.protocol+e;if(e.match(/^[a-z]+:/i))return e;const n=document.implementation.createHTMLDocument(),r=n.createElement("base"),i=n.createElement("a");return n.head.appendChild(r),n.body.appendChild(i),t&&(r.href=t),i.href=e,i.href}function Ce(e){return e.search(/^(data:)/)!==-1}function Se(e,t){return`data:${t};base64,${e}`}function Ut(e){return e.split(/,/)[1]}const Vt=function(){let t=0;const n=()=>`0000${(Math.random()*Math.pow(36,4)<<0).toString(36)}`.slice(-4);return()=>(t+=1,`u${n()}${t}`)}();function z(e){const t=[];for(let n=0,r=e.length;n<r;n+=1)t.push(e[n]);return t}function je(e,t){const n=window.getComputedStyle(e).getPropertyValue(t);return parseFloat(n.replace("px",""))}function Ht(e){const t=je(e,"border-left-width"),n=je(e,"border-right-width");return e.clientWidth+t+n}function Wt(e){const t=je(e,"border-top-width"),n=je(e,"border-bottom-width");return e.clientHeight+t+n}function qt(){let e,t;try{t=process}catch{}const n=t&&t.env?t.env.devicePixelRatio:null;return n&&(e=parseInt(n,10),Number.isNaN(e)&&(e=1)),e||window.devicePixelRatio||1}function zt(e){return e.toBlob?new Promise(t=>e.toBlob(t)):new Promise(t=>{const n=window.atob(e.toDataURL().split(",")[1]),r=n.length,i=new Uint8Array(r);for(let o=0;o<r;o+=1)i[o]=n.charCodeAt(o);t(new Blob([i],{type:"image/png"}))})}function Pe(e){return new Promise((t,n)=>{const r=new Image;r.onload=()=>t(r),r.onerror=n,r.crossOrigin="anonymous",r.decoding="sync",r.src=e})}function Gt(e){return qe(this,void 0,void 0,function*(){return Promise.resolve().then(()=>new XMLSerializer().serializeToString(e)).then(encodeURIComponent).then(t=>`data:image/svg+xml;charset=utf-8,${t}`)})}function Jt(e,t,n){return qe(this,void 0,void 0,function*(){const r="http://www.w3.org/2000/svg",i=document.createElementNS(r,"svg"),o=document.createElementNS(r,"foreignObject");return i.setAttribute("width",`${t}`),i.setAttribute("height",`${n}`),i.setAttribute("viewBox",`0 0 ${t} ${n}`),o.setAttribute("width","100%"),o.setAttribute("height","100%"),o.setAttribute("x","0"),o.setAttribute("y","0"),o.setAttribute("externalResourcesRequired","true"),i.appendChild(o),o.appendChild(e),Gt(i)})}const Le={};function Xt(e){let t=e.replace(/\?.*/,"");return/ttf|otf|eot|woff2?/i.test(t)&&(t=t.replace(/.*\//,"")),t}function Ae(e,t){const n=Xt(e);if(Le[n]!=null)return Le[n];t.cacheBust&&(e+=(/\?/.test(e)?"&":"?")+new Date().getTime());const r=o=>{let s="";if(t.imagePlaceholder){const c=t.imagePlaceholder.split(/,/);c&&c[1]&&(s=c[1])}let l=`Failed to fetch resource: ${e}`;return o&&(l=typeof o=="string"?o:o.message),l&&console.error(l),{blob:s,contentType:""}},i=window.fetch(e).then(o=>o.blob().then(s=>({blob:s,contentType:o.headers.get("Content-Type")||""}))).then(({blob:o,contentType:s})=>new Promise((l,c)=>{const u=new FileReader;u.onloadend=()=>l({contentType:s,blob:u.result}),u.onerror=c,u.readAsDataURL(o)})).then(({blob:o,contentType:s})=>({contentType:s,blob:Ut(o)})).catch(r);return Le[n]=i,i}function Kt(e){const t=e.getPropertyValue("content");return`${e.cssText} content: '${t.replace(/'|"/g,"")}';`}function Qt(e){return z(e).map(t=>{const n=e.getPropertyValue(t),r=e.getPropertyPriority(t);return`${t}: ${n}${r?" !important":""};`}).join(" ")}function Yt(e,t,n){const r=`.${e}:${t}`,i=n.cssText?Kt(n):Qt(n);return document.createTextNode(`${r}{${i}}`)}function Je(e,t,n){const r=window.getComputedStyle(e,n),i=r.getPropertyValue("content");if(i===""||i==="none")return;const o=Vt();try{t.className=`${t.className} ${o}`}catch{return}const s=document.createElement("style");s.appendChild(Yt(o,n,r)),t.appendChild(s)}function Zt(e,t){Je(e,t,":before"),Je(e,t,":after")}var re=globalThis&&globalThis.__awaiter||function(e,t,n,r){function i(o){return o instanceof n?o:new n(function(s){s(o)})}return new(n||(n=Promise))(function(o,s){function l(a){try{u(r.next(a))}catch(f){s(f)}}function c(a){try{u(r.throw(a))}catch(f){s(f)}}function u(a){a.done?o(a.value):i(a.value).then(l,c)}u((r=r.apply(e,t||[])).next())})};function Nt(e){return re(this,void 0,void 0,function*(){const t=e.toDataURL();return t==="data:,"?Promise.resolve(e.cloneNode(!1)):Pe(t)})}function en(e,t){return re(this,void 0,void 0,function*(){return Promise.resolve(e.poster).then(n=>Ae(n,t)).then(n=>Se(n.blob,ye(e.poster)||n.contentType)).then(n=>Pe(n))})}function tn(e,t){return re(this,void 0,void 0,function*(){return e instanceof HTMLCanvasElement?Nt(e):e instanceof HTMLVideoElement&&e.poster?en(e,t):Promise.resolve(e.cloneNode(!1))})}const nn=e=>e.tagName!=null&&e.tagName.toUpperCase()==="SLOT";function rn(e,t,n){var r;return re(this,void 0,void 0,function*(){const i=nn(e)&&e.assignedNodes?z(e.assignedNodes()):z(((r=e.shadowRoot)!==null&&r!==void 0?r:e).childNodes);return i.length===0||e instanceof HTMLVideoElement?Promise.resolve(t):i.reduce((o,s)=>o.then(()=>Xe(s,n)).then(l=>{l&&t.appendChild(l)}),Promise.resolve()).then(()=>t)})}function on(e,t){const n=window.getComputedStyle(e),r=t.style;!r||(n.cssText?r.cssText=n.cssText:z(n).forEach(i=>{r.setProperty(i,n.getPropertyValue(i),n.getPropertyPriority(i))}))}function sn(e,t){e instanceof HTMLTextAreaElement&&(t.innerHTML=e.value),e instanceof HTMLInputElement&&t.setAttribute("value",e.value)}function ln(e,t){return re(this,void 0,void 0,function*(){return t instanceof Element?Promise.resolve().then(()=>on(e,t)).then(()=>Zt(e,t)).then(()=>sn(e,t)).then(()=>t):Promise.resolve(t)})}function Xe(e,t,n){return re(this,void 0,void 0,function*(){return!n&&t.filter&&!t.filter(e)?Promise.resolve(null):Promise.resolve(e).then(r=>tn(r,t)).then(r=>rn(e,r,t)).then(r=>ln(e,r))})}var cn=globalThis&&globalThis.__awaiter||function(e,t,n,r){function i(o){return o instanceof n?o:new n(function(s){s(o)})}return new(n||(n=Promise))(function(o,s){function l(a){try{u(r.next(a))}catch(f){s(f)}}function c(a){try{u(r.throw(a))}catch(f){s(f)}}function u(a){a.done?o(a.value):i(a.value).then(l,c)}u((r=r.apply(e,t||[])).next())})};const Ke=/url\((['"]?)([^'"]+?)\1\)/g,un=/url\([^)]+\)\s*format\((["'])([^"']+)\1\)/g,an=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function fn(e){const t=e.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1");return new RegExp(`(url\\(['"]?)(${t})(['"]?\\))`,"g")}function hn(e){const t=[];return e.replace(Ke,(n,r,i)=>(t.push(i),n)),t.filter(n=>!Ce(n))}function dn(e,t,n,r,i){const o=n?Bt(t,n):t;return Promise.resolve(o).then(s=>i?i(s):Ae(s,r)).then(s=>typeof s=="string"?Se(s,ye(t)):Se(s.blob,ye(t)||s.contentType)).then(s=>e.replace(fn(t),`$1${s}$3`)).then(s=>s,()=>o)}function mn(e,{preferredFontFormat:t}){return t?e.replace(an,n=>{for(;;){const[r,,i]=un.exec(n)||[];if(!i)return"";if(i===t)return`src: ${r};`}}):e}function Qe(e){return e.search(Ke)!==-1}function Ye(e,t,n){return cn(this,void 0,void 0,function*(){if(!Qe(e))return Promise.resolve(e);const r=mn(e,n);return Promise.resolve(r).then(hn).then(i=>i.reduce((o,s)=>o.then(l=>dn(l,s,t,n)),Promise.resolve(r)))})}var $e=globalThis&&globalThis.__awaiter||function(e,t,n,r){function i(o){return o instanceof n?o:new n(function(s){s(o)})}return new(n||(n=Promise))(function(o,s){function l(a){try{u(r.next(a))}catch(f){s(f)}}function c(a){try{u(r.throw(a))}catch(f){s(f)}}function u(a){a.done?o(a.value):i(a.value).then(l,c)}u((r=r.apply(e,t||[])).next())})};function gn(e,t){var n;return $e(this,void 0,void 0,function*(){const r=(n=e.style)===null||n===void 0?void 0:n.getPropertyValue("background");return r?Promise.resolve(r).then(i=>Ye(i,null,t)).then(i=>(e.style.setProperty("background",i,e.style.getPropertyPriority("background")),e)):Promise.resolve(e)})}function pn(e,t){return $e(this,void 0,void 0,function*(){if(!(e instanceof HTMLImageElement&&!Ce(e.src))&&!(e instanceof SVGImageElement&&!Ce(e.href.baseVal)))return Promise.resolve(e);const n=e instanceof HTMLImageElement?e.src:e.href.baseVal;return Promise.resolve(n).then(r=>Ae(r,t)).then(r=>Se(r.blob,ye(n)||r.contentType)).then(r=>new Promise((i,o)=>{e.onload=i,e.onerror=o,e instanceof HTMLImageElement?(e.srcset="",e.src=r):e.href.baseVal=r})).then(()=>e,()=>e)})}function bn(e,t){return $e(this,void 0,void 0,function*(){const r=z(e.childNodes).map(i=>Ze(i,t));return Promise.all(r).then(()=>e)})}function Ze(e,t){return $e(this,void 0,void 0,function*(){return e instanceof Element?Promise.resolve(e).then(n=>gn(n,t)).then(n=>pn(n,t)).then(n=>bn(n,t)):Promise.resolve(e)})}function vn(e,t){const{style:n}=e;t.backgroundColor&&(n.backgroundColor=t.backgroundColor),t.width&&(n.width=`${t.width}px`),t.height&&(n.height=`${t.height}px`);const r=t.style;return r!=null&&Object.keys(r).forEach(i=>{n[i]=r[i]}),e}var ae=globalThis&&globalThis.__awaiter||function(e,t,n,r){function i(o){return o instanceof n?o:new n(function(s){s(o)})}return new(n||(n=Promise))(function(o,s){function l(a){try{u(r.next(a))}catch(f){s(f)}}function c(a){try{u(r.throw(a))}catch(f){s(f)}}function u(a){a.done?o(a.value):i(a.value).then(l,c)}u((r=r.apply(e,t||[])).next())})};const Ne={};function et(e){const t=Ne[e];if(t!=null)return t;const n=window.fetch(e).then(r=>({url:e,cssText:r.text()}));return Ne[e]=n,n}function tt(e){return ae(this,void 0,void 0,function*(){return e.cssText.then(t=>{let n=t;const r=/url\(["']?([^"')]+)["']?\)/g,o=(n.match(/url\([^)]+\)/g)||[]).map(s=>{let l=s.replace(r,"$1");return l.startsWith("https://")||(l=new URL(l,e.url).href),window.fetch(l).then(c=>c.blob()).then(c=>new Promise((u,a)=>{const f=new FileReader;f.onloadend=()=>{n=n.replace(s,`url(${f.result})`),u([s,f.result])},f.onerror=a,f.readAsDataURL(c)}))});return Promise.all(o).then(()=>n)})})}function nt(e){if(e==null)return[];const t=[],n=/(\/\*[\s\S]*?\*\/)/gi;let r=e.replace(n,"");const i=new RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");for(;;){const c=i.exec(r);if(c===null)break;t.push(c[0])}r=r.replace(i,"");const o=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,s="((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})",l=new RegExp(s,"gi");for(;;){let c=o.exec(r);if(c===null){if(c=l.exec(r),c===null)break;o.lastIndex=l.lastIndex}else l.lastIndex=o.lastIndex;t.push(c[0])}return t}function wn(e){return ae(this,void 0,void 0,function*(){const t=[],n=[];return e.forEach(r=>{if("cssRules"in r)try{z(r.cssRules).forEach((i,o)=>{if(i.type===CSSRule.IMPORT_RULE){let s=o+1;const l=i.href,c=et(l).then(u=>u?tt(u):"").then(u=>nt(u).forEach(a=>{try{r.insertRule(a,a.startsWith("@import")?s+=1:r.cssRules.length)}catch(f){console.error("Error inserting rule from remote css",{rule:a,error:f})}})).catch(u=>{console.error("Error loading remote css",u.toString())});n.push(c)}})}catch(i){const o=e.find(s=>s.href==null)||document.styleSheets[0];r.href!=null&&n.push(et(r.href).then(s=>s?tt(s):"").then(s=>nt(s).forEach(l=>{o.insertRule(l,r.cssRules.length)})).catch(s=>{console.error("Error loading remote stylesheet",s.toString())})),console.error("Error inlining remote css file",i.toString())}}),Promise.all(n).then(()=>(e.forEach(r=>{if("cssRules"in r)try{z(r.cssRules).forEach(i=>{t.push(i)})}catch(i){console.error(`Error while reading CSS rules from ${r.href}`,i.toString())}}),t))})}function _n(e){return e.filter(t=>t.type===CSSRule.FONT_FACE_RULE).filter(t=>Qe(t.style.getPropertyValue("src")))}function yn(e){return ae(this,void 0,void 0,function*(){return new Promise((t,n)=>{e.ownerDocument==null&&n(new Error("Provided element is not within a Document")),t(z(e.ownerDocument.styleSheets))}).then(t=>wn(t)).then(_n)})}function Sn(e,t){return ae(this,void 0,void 0,function*(){return yn(e).then(n=>Promise.all(n.map(r=>{const i=r.parentStyleSheet?r.parentStyleSheet.href:null;return Ye(r.cssText,i,t)}))).then(n=>n.join(`
`))})}function jn(e,t){return ae(this,void 0,void 0,function*(){return(t.fontEmbedCSS!=null?Promise.resolve(t.fontEmbedCSS):Sn(e,t)).then(n=>{const r=document.createElement("style"),i=document.createTextNode(n);return r.appendChild(i),e.firstChild?e.insertBefore(r,e.firstChild):e.appendChild(r),e})})}var Oe=globalThis&&globalThis.__awaiter||function(e,t,n,r){function i(o){return o instanceof n?o:new n(function(s){s(o)})}return new(n||(n=Promise))(function(o,s){function l(a){try{u(r.next(a))}catch(f){s(f)}}function c(a){try{u(r.throw(a))}catch(f){s(f)}}function u(a){a.done?o(a.value):i(a.value).then(l,c)}u((r=r.apply(e,t||[])).next())})};function rt(e,t={}){const n=t.width||Ht(e),r=t.height||Wt(e);return{width:n,height:r}}function $n(e,t={}){return Oe(this,void 0,void 0,function*(){const{width:n,height:r}=rt(e,t);return Promise.resolve(e).then(i=>Xe(i,t,!0)).then(i=>jn(i,t)).then(i=>Ze(i,t)).then(i=>vn(i,t)).then(i=>Jt(i,n,r))})}const E=16384;function xn(e){(e.width>E||e.height>E)&&(e.width>E&&e.height>E?e.width>e.height?(e.height*=E/e.width,e.width=E):(e.width*=E/e.height,e.height=E):e.width>E?(e.height*=E/e.width,e.width=E):(e.width*=E/e.height,e.height=E))}function kn(e,t={}){return Oe(this,void 0,void 0,function*(){return $n(e,t).then(Pe).then(n=>{const r=document.createElement("canvas"),i=r.getContext("2d"),o=t.pixelRatio||qt(),{width:s,height:l}=rt(e,t),c=t.canvasWidth||s,u=t.canvasHeight||l;return r.width=c*o,r.height=u*o,t.skipAutoScale||xn(r),r.style.width=`${c}`,r.style.height=`${u}`,t.backgroundColor&&(i.fillStyle=t.backgroundColor,i.fillRect(0,0,r.width,r.height)),i.drawImage(n,0,0,r.width,r.height),r})})}function En(e,t={}){return Oe(this,void 0,void 0,function*(){return kn(e,t).then(zt)})}async function it(e){var r,i;const t=(r=document.body.shadowRoot)==null?void 0:r.querySelector("main");let n=t==null?void 0:t.cloneNode(!0);(i=t==null?void 0:t.parentElement)==null||i.appendChild(n),n.style.margin="initial",n.querySelectorAll("tr").forEach((o,s)=>{s>(e=="b30"?30:40)&&o.remove()}),En(n,{backgroundColor:"#113"}).then(async o=>{if(n.remove(),o==null)return alert("[chuni-intl-viewer] Something went wrong when converting your scores to PNG. Please ask the author to fix it.");if(De()){const s=new File([o],`result_${e}.png`,{type:o.type});navigator!=null&&navigator.canShare({files:[s]})&&navigator.share({files:[s]}).catch(console.log)}else $("<a>").attr({download:`result_${e}.png`,href:window.URL.createObjectURL(o)})[0].click()})}function Tn(e){me(e,"svelte-h7j0em","main.svelte-h7j0em.svelte-h7j0em{width:fit-content;margin:auto}button.svelte-h7j0em.svelte-h7j0em{margin:0.5rem;padding:0.3rem;font-family:inherit;font-weight:bold;background-color:#324;border:#536 3px solid;color:#eec;border-radius:0.3rem;cursor:pointer}button.svelte-h7j0em.svelte-h7j0em:disabled{cursor:default;opacity:0.5}button.filter.svelte-h7j0em.svelte-h7j0em,button.sort.svelte-h7j0em.svelte-h7j0em{border-color:#48c;background-color:#159}button.sort.svelte-h7j0em.svelte-h7j0em{width:7rem}button.dl.svelte-h7j0em i.svelte-h7j0em{background-image:url(https://raw.githubusercontent.com/Dogeon188/chuni_new_intl_viewer/main/assets/dl.png);display:inline-block;width:1rem;height:1rem;background-position:0px 0px;background-size:cover}table.svelte-h7j0em.svelte-h7j0em{border-spacing:0;width:100%;padding-bottom:0.5rem;max-width:max-content;margin:auto}td.svelte-h7j0em.svelte-h7j0em,th.svelte-h7j0em.svelte-h7j0em{padding:0.5rem}th.current-sort.svelte-h7j0em.svelte-h7j0em{text-decoration:underline double #669}tbody.svelte-h7j0em tr.best30 td.svelte-h7j0em:first-child{color:#fc4}tbody.svelte-h7j0em tr.best40 td.svelte-h7j0em:first-child{font-weight:bold}tbody.svelte-h7j0em tr.svelte-h7j0em:nth-child(odd){background-color:#224}tbody.svelte-h7j0em tr td.svelte-h7j0em:nth-child(2){overflow:hidden;text-overflow:ellipsis;font-weight:bold;text-align:initial;max-width:300px}tbody.svelte-h7j0em tr td:nth-child(2).diff-ult.svelte-h7j0em{color:#3cf}tbody.svelte-h7j0em tr td:nth-child(2).diff-mas.svelte-h7j0em{color:#e9f}tbody.svelte-h7j0em tr td:nth-child(2).diff-exp.svelte-h7j0em{color:#e46}tbody.svelte-h7j0em tr td:nth-child(2).diff-adv.svelte-h7j0em{color:#e73}tbody.svelte-h7j0em tr td:nth-child(2).diff-bas.svelte-h7j0em{color:#1c3}span.clear-fc.svelte-h7j0em.svelte-h7j0em{color:#5e7;font-weight:bold}span.clear-aj.svelte-h7j0em.svelte-h7j0em{color:#fc1;font-weight:bold}")}function ot(e,t,n){const r=e.slice();return r[13]=t[n],r}function st(e,t,n){const r=e.slice();return r[16]=t[n],r}function lt(e){let t,n,r,i;function o(){return e[11](e[16])}return{c(){t=b("th"),n=x(e[16]),v(t,"class","svelte-h7j0em"),N(t,"current-sort",e[16]==Object.keys(e[3])[e[1]])},m(s,l){M(s,t,l),h(t,n),r||(i=se(t,"click",o),r=!0)},p(s,l){e=s,l&10&&N(t,"current-sort",e[16]==Object.keys(e[3])[e[1]])},d(s){s&&L(t),r=!1,i()}}}function ct(e){let t,n=e[13].clear+"",r,i;return{c(){var o;t=b("span"),r=x(n),v(t,"class",i="clear-"+((o=e[13].clear)==null?void 0:o.toLowerCase())+" svelte-h7j0em")},m(o,s){M(o,t,s),h(t,r)},p(o,s){var l;s&4&&n!==(n=o[13].clear+"")&&A(r,n),s&4&&i!==(i="clear-"+((l=o[13].clear)==null?void 0:l.toLowerCase())+" svelte-h7j0em")&&v(t,"class",i)},d(o){o&&L(t)}}}function ut(e){var Y,he,X,D;let t,n,r=e[13].rank+"",i,o,s,l=e[13].title+"",c,u,a,f,S=((he=(Y=e[13].const)==null?void 0:Y.toFixed(1))!=null?he:"??.?")+"",O,C,m,g=e[13].score+"",T,fe,B,G=((D=(X=e[13].rating)==null?void 0:X.toFixed(2))!=null?D:"??.??")+"",F,U,J,V,_=e[13].clear!==null&&ct(e);return{c(){t=b("tr"),n=b("td"),i=x(r),o=y(),s=b("td"),c=x(l),a=y(),f=b("td"),O=x(S),C=y(),m=b("td"),T=x(g),fe=y(),B=b("td"),F=x(G),U=y(),J=b("td"),_&&_.c(),V=y(),v(n,"class","svelte-h7j0em"),v(s,"class",u="diff-"+e[13].difficulty.toLowerCase()+" svelte-h7j0em"),v(f,"class","svelte-h7j0em"),v(m,"class","svelte-h7j0em"),v(B,"class","svelte-h7j0em"),v(J,"class","svelte-h7j0em"),v(t,"class","svelte-h7j0em"),N(t,"best30",e[13].rank<=30),N(t,"best40",e[13].rank<=40)},m(w,k){M(w,t,k),h(t,n),h(n,i),h(t,o),h(t,s),h(s,c),h(t,a),h(t,f),h(f,O),h(t,C),h(t,m),h(m,T),h(t,fe),h(t,B),h(B,F),h(t,U),h(t,J),_&&_.m(J,null),h(t,V)},p(w,k){var ie,R,H,j;k&4&&r!==(r=w[13].rank+"")&&A(i,r),k&4&&l!==(l=w[13].title+"")&&A(c,l),k&4&&u!==(u="diff-"+w[13].difficulty.toLowerCase()+" svelte-h7j0em")&&v(s,"class",u),k&4&&S!==(S=((R=(ie=w[13].const)==null?void 0:ie.toFixed(1))!=null?R:"??.?")+"")&&A(O,S),k&4&&g!==(g=w[13].score+"")&&A(T,g),k&4&&G!==(G=((j=(H=w[13].rating)==null?void 0:H.toFixed(2))!=null?j:"??.??")+"")&&A(F,G),w[13].clear!==null?_?_.p(w,k):(_=ct(w),_.c(),_.m(J,null)):_&&(_.d(1),_=null),k&4&&N(t,"best30",w[13].rank<=30),k&4&&N(t,"best40",w[13].rank<=40)},d(w){w&&L(t),_&&_.d()}}}function Rn(e){let t,n,r=e[0]?"Show All":"Show B40",i,o,s,l,c=Object.keys(e[3])[e[1]]+"",u,a,f,S,O,C,m,g,T,fe,B,G,F,U,J,V,_,Y,he,X,D,w,k;U=new Dt({props:{b30:We(e[4]),maxAchievable:xt(e[4])}});let ie=["#","Title","Const.","Score","Rating","AJ"],R=[];for(let d=0;d<6;d+=1)R[d]=lt(st(e,ie,d));let H=e[2],j=[];for(let d=0;d<H.length;d+=1)j[d]=ut(ot(e,H,d));return{c(){t=b("div"),n=b("button"),i=x(r),o=y(),s=b("button"),l=x("Sort: "),u=x(c),a=y(),f=b("button"),S=b("i"),O=x("Best 30"),m=y(),g=b("button"),T=b("i"),fe=x("Best 40"),G=y(),F=b("main"),ue(U.$$.fragment),J=y(),V=b("table"),_=b("thead"),Y=b("tr");for(let d=0;d<6;d+=1)R[d].c();he=y(),X=b("tbody");for(let d=0;d<j.length;d+=1)j[d].c();v(n,"class","filter svelte-h7j0em"),v(s,"class","sort svelte-h7j0em"),v(S,"class","svelte-h7j0em"),v(f,"class","dl svelte-h7j0em"),f.disabled=C=e[1]!=0,v(T,"class","svelte-h7j0em"),v(g,"class","dl svelte-h7j0em"),g.disabled=B=e[1]!=0,v(t,"class","buttons"),v(X,"class","svelte-h7j0em"),v(V,"class","svelte-h7j0em"),v(F,"class","svelte-h7j0em")},m(d,P){M(d,t,P),h(t,n),h(n,i),h(t,o),h(t,s),h(s,l),h(s,u),h(t,a),h(t,f),h(f,S),h(f,O),h(t,m),h(t,g),h(g,T),h(g,fe),M(d,G,P),M(d,F,P),ee(U,F,null),h(F,J),h(F,V),h(V,_),h(_,Y);for(let p=0;p<6;p+=1)R[p].m(Y,null);h(V,he),h(V,X);for(let p=0;p<j.length;p+=1)j[p].m(X,null);D=!0,w||(k=[se(n,"click",e[7]),se(s,"click",e[8]),se(f,"click",e[9]),se(g,"click",e[10])],w=!0)},p(d,[P]){if((!D||P&1)&&r!==(r=d[0]?"Show All":"Show B40")&&A(i,r),(!D||P&2)&&c!==(c=Object.keys(d[3])[d[1]]+"")&&A(u,c),(!D||P&2&&C!==(C=d[1]!=0))&&(f.disabled=C),(!D||P&2&&B!==(B=d[1]!=0))&&(g.disabled=B),P&11){ie=["#","Title","Const.","Score","Rating","AJ"];let p;for(p=0;p<6;p+=1){const de=st(d,ie,p);R[p]?R[p].p(de,P):(R[p]=lt(de),R[p].c(),R[p].m(Y,null))}for(;p<6;p+=1)R[p].d(1)}if(P&4){H=d[2];let p;for(p=0;p<H.length;p+=1){const de=ot(d,H,p);j[p]?j[p].p(de,P):(j[p]=ut(de),j[p].c(),j[p].m(X,null))}for(;p<j.length;p+=1)j[p].d(1);j.length=H.length}},i(d){D||(W(U.$$.fragment,d),D=!0)},o(d){Q(U.$$.fragment,d),D=!1},d(d){d&&L(t),d&&L(G),d&&L(F),te(U),Be(R,d),Be(j,d),w=!1,Z(k)}}}function Cn(e,t,n){let r,i,{recordList:o}=t,s=De(),l=0;const c={Rating:(m,g)=>g.rating-m.rating||g.const-m.const,Score:(m,g)=>g.score-m.score,"Const.":(m,g)=>g.const-m.const,Title:(m,g)=>{if(m.title<g.title)return-1;if(m.title>g.title)return 1;const T=["ULT","MAS","EXP","ADV","BAS"];return T.indexOf(g.difficulty)-T.indexOf(m.difficulty)},AJ:(m,g)=>{if(m.clear==g.clear)return g.rating-m.rating||g.const-m.const;const T=[null,"FC","AJ"];return T.indexOf(g.clear)-T.indexOf(m.clear)}},u=o.map(m=>m.rating);o.filter(m=>m.difficulty==="MAS").map(m=>m.score).reduce((m,g)=>m+g);const a=()=>{n(0,s=!s),s&&n(1,l=0)},f=()=>{n(1,l=(l+1)%Object.keys(c).length),n(0,s=!1)},S=()=>it("b30"),O=()=>it("b40"),C=m=>{let g=Object.keys(c).indexOf(m=="#"?"Rating":m);g>=0&&n(1,l=g),g>0&&n(0,s=!1)};return e.$$set=m=>{"recordList"in m&&n(5,o=m.recordList)},e.$$.update=()=>{e.$$.dirty&34&&n(6,r=o.sort(Object.values(c)[l])),e.$$.dirty&65&&n(2,i=s?r.slice(0,40):r)},[s,l,i,c,u,o,r,a,f,S,O,C]}class Pn extends we{constructor(t){super(),ve(this,t,Cn,Rn,oe,{recordList:5},Tn)}}function Ln(e){me(e,"svelte-17lywe3","body.svelte-17lywe3.svelte-17lywe3{padding-top:1rem;background-color:#113;color:#eec;margin:0;font-size:14px;min-height:100%;min-width:fit-content}body.svelte-17lywe3 a.svelte-17lywe3{color:#3cc;text-decoration:none}")}function An(e){let t,n;return t=new Pn({props:{recordList:e[1]}}),{c(){ue(t.$$.fragment)},m(r,i){ee(t,r,i),n=!0},p(r,i){const o={};i&2&&(o.recordList=r[1]),t.$set(o)},i(r){n||(W(t.$$.fragment,r),n=!0)},o(r){Q(t.$$.fragment,r),n=!1},d(r){te(t,r)}}}function On(e){let t,n,r,i,o;return{c(){t=b("div"),n=b("p"),n.textContent="Loading...",r=y(),i=b("p"),o=x(e[2])},m(s,l){M(s,t,l),h(t,n),h(t,r),h(t,i),h(i,o)},p(s,l){l&4&&A(o,s[2])},i:I,o:I,d(s){s&&L(t)}}}function Fn(e){let t,n,r,i,o,s;const l=[On,An],c=[];function u(a,f){return a[0]?1:0}return i=u(e),o=c[i]=l[i](e),{c(){t=b("body"),n=b("div"),n.innerHTML=`<h3>Chunithm International Score Viewer</h3> 
        <a href="https://github.com/Dogeon188/chuni_new_intl_viewer" target="_blank" rel="noopener noreferrer" class="svelte-17lywe3">Dogeon188/chuni_new_intl_viewer@GitHub</a>`,r=y(),o.c(),v(t,"class","svelte-17lywe3")},m(a,f){M(a,t,f),h(t,n),h(t,r),c[i].m(t,null),s=!0},p(a,[f]){let S=i;i=u(a),i===S?c[i].p(a,f):(yt(),Q(c[S],1,1,()=>{c[S]=null}),St(),o=c[i],o?o.p(a,f):(o=c[i]=l[i](a),o.c()),W(o,1),o.m(t,null))},i(a){s||(W(o),s=!0)},o(a){Q(o),s=!1},d(a){a&&L(t),c[i].d()}}}function Dn(e,t,n){let r;mt(e,_e,s=>n(2,r=s));let i=!1,o=[];return(async()=>(n(1,o=await Rt()),n(0,i=!0)))(),[i,o,r]}class In extends we{constructor(t){super(),ve(this,t,Dn,Fn,oe,{},Ln)}}async function Mn(){if(window.chuniIntlViewer){alert("[chuni-intl-viewer] Please refresh the page before another new fetch.");return}if(window.chuniIntlViewer=!0,window.location.hostname!=="chunithm-net-eng.com"){alert("[chuni_intl_viewer] This tools could only be used under chunithm-net international."),window.location.href="https://chunithm-net-eng.com/";return}if(!Fe("_t")){alert("[chuni-intl-viewer] Token not found. Please login first."),window.location.href="https://chunithm-net-eng.com/";return}const e=document.body.attachShadow({mode:"open"});new In({target:e})}Mn()})();
